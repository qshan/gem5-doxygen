<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>gem5: mem/coherent_xbar.cc Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">gem5
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_2de8987802321a9d5e743b7f5a980a44.html">mem</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">coherent_xbar.cc</div>  </div>
</div><!--header-->
<div class="contents">
<a href="coherent__xbar_8cc.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * Copyright (c) 2011-2019 ARM Limited</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> * All rights reserved</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> * The license below extends only to copyright in the software and shall</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * not be construed as granting a license to any other intellectual</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> * property including but not limited to intellectual property relating</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * to a hardware implementation of the functionality of the software</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> * licensed hereunder.  You may use the software subject to the license</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * terms below provided that you ensure that this notice is replicated</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * unmodified and in its entirety in all distributions of the software,</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * modified or unmodified, in source code or in binary form.</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> * Copyright (c) 2006 The Regents of The University of Michigan</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * All rights reserved.</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> * Redistribution and use in source and binary forms, with or without</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> * modification, are permitted provided that the following conditions are</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> * met: redistributions of source code must retain the above copyright</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> * notice, this list of conditions and the following disclaimer;</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"> * redistributions in binary form must reproduce the above copyright</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"> * notice, this list of conditions and the following disclaimer in the</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"> * documentation and/or other materials provided with the distribution;</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"> * neither the name of the copyright holders nor the names of its</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment"> * contributors may be used to endorse or promote products derived from</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment"> * this software without specific prior written permission.</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment"> * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment"> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment"> * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment"> * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment"> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment"> * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment"> * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment"> * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment"> * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment"> * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment"> * Authors: Ali Saidi</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment"> *          Andreas Hansson</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment"> *          William Wang</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment"> *          Nikos Nikoleris</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="coherent__xbar_8hh.html">mem/coherent_xbar.hh</a>&quot;</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="logging_8hh.html">base/logging.hh</a>&quot;</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="base_2trace_8hh.html">base/trace.hh</a>&quot;</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="preprocessor">#include &quot;debug/AddrRanges.hh&quot;</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="preprocessor">#include &quot;debug/CoherentXBar.hh&quot;</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="sim_2system_8hh.html">sim/system.hh</a>&quot;</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div><div class="line"><a name="l00059"></a><span class="lineno"><a class="line" href="classCoherentXBar.html#a4c9ed4ae8ea2994335c52927ee205c89">   59</a></span>&#160;<a class="code" href="classCoherentXBar.html#a4c9ed4ae8ea2994335c52927ee205c89">CoherentXBar::CoherentXBar</a>(<span class="keyword">const</span> CoherentXBarParams *<a class="code" href="namespaceMipsISA.html#ae12ae9e12fab22594609e2fefce7f7c2">p</a>)</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    : <a class="code" href="classBaseXBar.html">BaseXBar</a>(p), <a class="code" href="namespaceX86ISA.html#a313686d10ce407058a35bddec45c211f">system</a>(p-&gt;<a class="code" href="namespaceX86ISA.html#a313686d10ce407058a35bddec45c211f">system</a>), snoopFilter(p-&gt;snoop_filter),</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;      snoopResponseLatency(p-&gt;snoop_response_latency),</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;      maxOutstandingSnoopCheck(p-&gt;max_outstanding_snoops),</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;      maxRoutingTableSizeCheck(p-&gt;max_routing_table_size),</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;      pointOfCoherency(p-&gt;point_of_coherency),</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;      pointOfUnification(p-&gt;point_of_unification),</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;      snoops(this, <span class="stringliteral">&quot;snoops&quot;</span>, <span class="stringliteral">&quot;Total snoops (count)&quot;</span>),</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;      snoopTraffic(this, <span class="stringliteral">&quot;snoopTraffic&quot;</span>, <span class="stringliteral">&quot;Total snoop traffic (bytes)&quot;</span>),</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;      snoopFanout(this, <span class="stringliteral">&quot;snoop_fanout&quot;</span>, <span class="stringliteral">&quot;Request fanout histogram&quot;</span>)</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;{</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <span class="comment">// create the ports based on the size of the master and slave</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="comment">// vector ports, and the presence of the default port, the ports</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="comment">// are enumerated starting from zero</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a> = 0; <a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a> &lt; p-&gt;port_master_connection_count; ++<a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a>) {</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        std::string portName = <a class="code" href="cprintf_8hh.html#a848c8ad3ab12f32c2d70d72701307be2">csprintf</a>(<span class="stringliteral">&quot;%s.master[%d]&quot;</span>, <a class="code" href="classSimObject.html#ac6bf42a0c7d51f21477fc064f75178c1">name</a>(), <a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a>);</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        <a class="code" href="classMasterPort.html">MasterPort</a>* bp = <span class="keyword">new</span> <a class="code" href="classCoherentXBar_1_1CoherentXBarMasterPort.html">CoherentXBarMasterPort</a>(portName, *<span class="keyword">this</span>, <a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a>);</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;        <a class="code" href="classBaseXBar.html#a7121edb077f36aece2830ffae4dc2f2c">masterPorts</a>.push_back(bp);</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;        <a class="code" href="classCoherentXBar.html#a5b967590159ab1144f26e244bd3b9c2a">reqLayers</a>.push_back(<span class="keyword">new</span> <a class="code" href="classBaseXBar_1_1ReqLayer.html">ReqLayer</a>(*bp, *<span class="keyword">this</span>,</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;                                         <a class="code" href="cprintf_8hh.html#a848c8ad3ab12f32c2d70d72701307be2">csprintf</a>(<span class="stringliteral">&quot;reqLayer%d&quot;</span>, <a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a>)));</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        <a class="code" href="classCoherentXBar.html#acfd586ff5879edb3bc8e5281e4e1c728">snoopLayers</a>.push_back(</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;                <span class="keyword">new</span> <a class="code" href="classBaseXBar_1_1SnoopRespLayer.html">SnoopRespLayer</a>(*bp, *<span class="keyword">this</span>, <a class="code" href="cprintf_8hh.html#a848c8ad3ab12f32c2d70d72701307be2">csprintf</a>(<span class="stringliteral">&quot;snoopLayer%d&quot;</span>, <a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a>)));</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    }</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="comment">// see if we have a default slave device connected and if so add</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <span class="comment">// our corresponding master port</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="keywordflow">if</span> (p-&gt;port_default_connection_count) {</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        <a class="code" href="classBaseXBar.html#aaaec770d02c0625d3e471c7a99462537">defaultPortID</a> = <a class="code" href="classBaseXBar.html#a7121edb077f36aece2830ffae4dc2f2c">masterPorts</a>.size();</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        std::string portName = <a class="code" href="classSimObject.html#ac6bf42a0c7d51f21477fc064f75178c1">name</a>() + <span class="stringliteral">&quot;.default&quot;</span>;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        <a class="code" href="classMasterPort.html">MasterPort</a>* bp = <span class="keyword">new</span> <a class="code" href="classCoherentXBar_1_1CoherentXBarMasterPort.html">CoherentXBarMasterPort</a>(portName, *<span class="keyword">this</span>,</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;                                                    <a class="code" href="classBaseXBar.html#aaaec770d02c0625d3e471c7a99462537">defaultPortID</a>);</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        <a class="code" href="classBaseXBar.html#a7121edb077f36aece2830ffae4dc2f2c">masterPorts</a>.push_back(bp);</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        <a class="code" href="classCoherentXBar.html#a5b967590159ab1144f26e244bd3b9c2a">reqLayers</a>.push_back(<span class="keyword">new</span> <a class="code" href="classBaseXBar_1_1ReqLayer.html">ReqLayer</a>(*bp, *<span class="keyword">this</span>, <a class="code" href="cprintf_8hh.html#a848c8ad3ab12f32c2d70d72701307be2">csprintf</a>(<span class="stringliteral">&quot;reqLayer%d&quot;</span>,</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;                                         <a class="code" href="classBaseXBar.html#aaaec770d02c0625d3e471c7a99462537">defaultPortID</a>)));</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        <a class="code" href="classCoherentXBar.html#acfd586ff5879edb3bc8e5281e4e1c728">snoopLayers</a>.push_back(<span class="keyword">new</span> <a class="code" href="classBaseXBar_1_1SnoopRespLayer.html">SnoopRespLayer</a>(*bp, *<span class="keyword">this</span>,</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;                                                 <a class="code" href="cprintf_8hh.html#a848c8ad3ab12f32c2d70d72701307be2">csprintf</a>(<span class="stringliteral">&quot;snoopLayer%d&quot;</span>,</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;                                                          <a class="code" href="classBaseXBar.html#aaaec770d02c0625d3e471c7a99462537">defaultPortID</a>)));</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    }</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <span class="comment">// create the slave ports, once again starting at zero</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a> = 0; <a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a> &lt; p-&gt;port_slave_connection_count; ++<a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a>) {</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        std::string portName = <a class="code" href="cprintf_8hh.html#a848c8ad3ab12f32c2d70d72701307be2">csprintf</a>(<span class="stringliteral">&quot;%s.slave[%d]&quot;</span>, <a class="code" href="classSimObject.html#ac6bf42a0c7d51f21477fc064f75178c1">name</a>(), <a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a>);</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        <a class="code" href="classQueuedSlavePort.html">QueuedSlavePort</a>* bp = <span class="keyword">new</span> <a class="code" href="classCoherentXBar_1_1CoherentXBarSlavePort.html">CoherentXBarSlavePort</a>(portName, *<span class="keyword">this</span>, <a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a>);</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        <a class="code" href="classBaseXBar.html#a636f80defcaea192d77f020ff0d83f9a">slavePorts</a>.push_back(bp);</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        <a class="code" href="classCoherentXBar.html#aa8d178f10956856205fa921a76b64e30">respLayers</a>.push_back(<span class="keyword">new</span> <a class="code" href="classBaseXBar_1_1RespLayer.html">RespLayer</a>(*bp, *<span class="keyword">this</span>,</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;                                           <a class="code" href="cprintf_8hh.html#a848c8ad3ab12f32c2d70d72701307be2">csprintf</a>(<span class="stringliteral">&quot;respLayer%d&quot;</span>, <a class="code" href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">i</a>)));</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        <a class="code" href="classCoherentXBar.html#ae4bc8dc8c57cf49cbe8f4e9b4820abc6">snoopRespPorts</a>.push_back(<span class="keyword">new</span> <a class="code" href="classCoherentXBar_1_1SnoopRespPort.html">SnoopRespPort</a>(*bp, *<span class="keyword">this</span>));</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    }</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;}</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div><div class="line"><a name="l00110"></a><span class="lineno"><a class="line" href="classCoherentXBar.html#a9b7855d7f6292ed83f02a72021aab71e">  110</a></span>&#160;<a class="code" href="classCoherentXBar.html#a9b7855d7f6292ed83f02a72021aab71e">CoherentXBar::~CoherentXBar</a>()</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;{</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="namespaceMipsISA.html#aa834b70ca764da65920017e744b52dac">l</a>: <a class="code" href="classCoherentXBar.html#a5b967590159ab1144f26e244bd3b9c2a">reqLayers</a>)</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        <span class="keyword">delete</span> <a class="code" href="namespaceMipsISA.html#aa834b70ca764da65920017e744b52dac">l</a>;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="namespaceMipsISA.html#aa834b70ca764da65920017e744b52dac">l</a>: <a class="code" href="classCoherentXBar.html#aa8d178f10956856205fa921a76b64e30">respLayers</a>)</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        <span class="keyword">delete</span> <a class="code" href="namespaceMipsISA.html#aa834b70ca764da65920017e744b52dac">l</a>;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="namespaceMipsISA.html#aa834b70ca764da65920017e744b52dac">l</a>: <a class="code" href="classCoherentXBar.html#acfd586ff5879edb3bc8e5281e4e1c728">snoopLayers</a>)</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        <span class="keyword">delete</span> <a class="code" href="namespaceMipsISA.html#aa834b70ca764da65920017e744b52dac">l</a>;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="namespaceMipsISA.html#ae12ae9e12fab22594609e2fefce7f7c2">p</a>: <a class="code" href="classCoherentXBar.html#ae4bc8dc8c57cf49cbe8f4e9b4820abc6">snoopRespPorts</a>)</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        <span class="keyword">delete</span> <a class="code" href="namespaceMipsISA.html#ae12ae9e12fab22594609e2fefce7f7c2">p</a>;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;}</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="keywordtype">void</span></div><div class="line"><a name="l00123"></a><span class="lineno"><a class="line" href="classCoherentXBar.html#ae26e86486b723037aa83b6f488e05c97">  123</a></span>&#160;<a class="code" href="classCoherentXBar.html#ae26e86486b723037aa83b6f488e05c97">CoherentXBar::init</a>()</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;{</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <a class="code" href="classSimObject.html#a2a1c25d4de5184cccaca7f9b0b703a5d">BaseXBar::init</a>();</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <span class="comment">// iterate over our slave ports and determine which of our</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="comment">// neighbouring master ports are snooping and add them as snoopers</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code" href="namespaceMipsISA.html#ae12ae9e12fab22594609e2fefce7f7c2">p</a>: <a class="code" href="classBaseXBar.html#a636f80defcaea192d77f020ff0d83f9a">slavePorts</a>) {</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        <span class="comment">// check if the connected master port is snooping</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespaceMipsISA.html#ae12ae9e12fab22594609e2fefce7f7c2">p</a>-&gt;isSnooping()) {</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;            <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(AddrRanges, <span class="stringliteral">&quot;Adding snooping master %s\n&quot;</span>, <a class="code" href="namespaceMipsISA.html#ae12ae9e12fab22594609e2fefce7f7c2">p</a>-&gt;getPeer());</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;            <a class="code" href="classCoherentXBar.html#ade12b0118a2a220183b3392e0a2523f3">snoopPorts</a>.push_back(<a class="code" href="namespaceMipsISA.html#ae12ae9e12fab22594609e2fefce7f7c2">p</a>);</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        }</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    }</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classCoherentXBar.html#ade12b0118a2a220183b3392e0a2523f3">snoopPorts</a>.empty())</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        <a class="code" href="logging_8hh.html#a8224a361dddd2ad59b411982e5ea746f">warn</a>(<span class="stringliteral">&quot;CoherentXBar %s has no snooping ports attached!\n&quot;</span>, <a class="code" href="classSimObject.html#ac6bf42a0c7d51f21477fc064f75178c1">name</a>());</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="comment">// inform the snoop filter about the slave ports so it can create</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <span class="comment">// its own internal representation</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classCoherentXBar.html#a9f9454818f672a40a28538c8b8496633">snoopFilter</a>)</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        <a class="code" href="classCoherentXBar.html#a9f9454818f672a40a28538c8b8496633">snoopFilter</a>-&gt;<a class="code" href="classSnoopFilter.html#a06eeb117c6013133e4a62e005d6396b6">setSlavePorts</a>(slavePorts);</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;}</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="keywordtype">bool</span></div><div class="line"><a name="l00147"></a><span class="lineno"><a class="line" href="classCoherentXBar.html#abaf0f43176c221e4546dca01aa7e43a8">  147</a></span>&#160;<a class="code" href="classCoherentXBar.html#abaf0f43176c221e4546dca01aa7e43a8">CoherentXBar::recvTimingReq</a>(<a class="code" href="classPacket.html">PacketPtr</a> pkt, <a class="code" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a> slave_port_id)</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;{</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <span class="comment">// determine the source port based on the id</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <a class="code" href="classSlavePort.html">SlavePort</a> *src_port = <a class="code" href="classBaseXBar.html#a636f80defcaea192d77f020ff0d83f9a">slavePorts</a>[slave_port_id];</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="comment">// remember if the packet is an express snoop</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="keywordtype">bool</span> is_express_snoop = pkt-&gt;<a class="code" href="classPacket.html#a4793369116c8c7782ed5033539c7f543">isExpressSnoop</a>();</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="keywordtype">bool</span> cache_responding = pkt-&gt;<a class="code" href="classPacket.html#a14141460ec6de11c61eb6dc2ab5eda8f">cacheResponding</a>();</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="comment">// for normal requests, going downstream, the express snoop flag</span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <span class="comment">// and the cache responding flag should always be the same</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    assert(is_express_snoop == cache_responding);</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="comment">// determine the destination based on the destination address range</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <a class="code" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a> master_port_id = <a class="code" href="classBaseXBar.html#a727799d20d95a711af40fba377f26788">findPort</a>(pkt-&gt;<a class="code" href="classPacket.html#aa71d1ff754f712c337e8908a1595f8a0">getAddrRange</a>());</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <span class="comment">// test if the crossbar should be considered occupied for the current</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="comment">// port, and exclude express snoops from the check</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="keywordflow">if</span> (!is_express_snoop &amp;&amp; !<a class="code" href="classCoherentXBar.html#a5b967590159ab1144f26e244bd3b9c2a">reqLayers</a>[master_port_id]-&gt;tryTiming(src_port)) {</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classCoherentXBar.html">CoherentXBar</a>, <span class="stringliteral">&quot;%s: src %s packet %s BUSY\n&quot;</span>, __func__,</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;                src_port-&gt;<a class="code" href="classPort.html#a18a1938a97583fef5c9cb8433df30ceb">name</a>(), pkt-&gt;<a class="code" href="classPacket.html#a7a19b40cc01e43c41bc99fb7fadb89ea">print</a>());</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    }</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classCoherentXBar.html">CoherentXBar</a>, <span class="stringliteral">&quot;%s: src %s packet %s\n&quot;</span>, __func__,</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;            src_port-&gt;<a class="code" href="classPort.html#a18a1938a97583fef5c9cb8433df30ceb">name</a>(), pkt-&gt;<a class="code" href="classPacket.html#a7a19b40cc01e43c41bc99fb7fadb89ea">print</a>());</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <span class="comment">// store size and command as they might be modified when</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="comment">// forwarding the packet</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pkt_size = pkt-&gt;<a class="code" href="classPacket.html#a389afe9616729132378ab8228a74441d">hasData</a>() ? pkt-&gt;<a class="code" href="classPacket.html#aaf1f26587ac7e1e5790b04931e35f64d">getSize</a>() : 0;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pkt_cmd = pkt-&gt;<a class="code" href="classPacket.html#a14a73789b61dfcffbba858ea6210ef4c">cmdToIndex</a>();</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <span class="comment">// store the old header delay so we can restore it if needed</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a> old_header_delay = pkt-&gt;<a class="code" href="classPacket.html#ae035c719eee7a7713ab831a11e9e7406">headerDelay</a>;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <span class="comment">// a request sees the frontend and forward latency</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a> xbar_delay = (<a class="code" href="classBaseXBar.html#ad10345cd3f63594c59921597e0614d53">frontendLatency</a> + <a class="code" href="classBaseXBar.html#af6aad4825ae3141ed0bac4c7b6a6fa23">forwardLatency</a>) * <a class="code" href="classClocked.html#aa7fa265550d8232e766522699ca8fa38">clockPeriod</a>();</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    <span class="comment">// set the packet header and payload delay</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <a class="code" href="classBaseXBar.html#a91a7cf37c038ad1e1f741ae43b076566">calcPacketTiming</a>(pkt, xbar_delay);</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="comment">// determine how long to be crossbar layer is busy</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a> packetFinishTime = <a class="code" href="classClocked.html#a082ec89d11f90b11b91ba7876040e41e">clockEdge</a>(<a class="code" href="classCycles.html">Cycles</a>(1)) + pkt-&gt;<a class="code" href="classPacket.html#a672f63108880c72376276d9ed01b3fc3">payloadDelay</a>;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="comment">// is this the destination point for this packet? (e.g. true if</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="comment">// this xbar is the PoC for a cache maintenance operation to the</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <span class="comment">// PoC) otherwise the destination is any cache that can satisfy</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="comment">// the request</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> is_destination = <a class="code" href="classCoherentXBar.html#a31f46d511a2a1753a1fd0e153cf71d39">isDestination</a>(pkt);</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> snoop_caches = !<a class="code" href="classCoherentXBar.html#a99e232a3411057cbefafe3e493fd342f">system</a>-&gt;<a class="code" href="classSystem.html#abc658a627235f9f0fee0a19fd34e43ab">bypassCaches</a>() &amp;&amp;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        pkt-&gt;<a class="code" href="classPacket.html#ade61bff6cd470a7ce6376f3c85bdd3ae">cmd</a> != <a class="code" href="classMemCmd.html#ae5c39c2de0ad998b5176bc519b358102ab4e404a2679503dfab0a93913fe7960b">MemCmd::WriteClean</a>;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="keywordflow">if</span> (snoop_caches) {</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        assert(pkt-&gt;<a class="code" href="classPacket.html#a5e4a9b04aa6384293ff44918805cdc02">snoopDelay</a> == 0);</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        <span class="keywordflow">if</span> (pkt-&gt;<a class="code" href="classPacket.html#ad1382602367d7ce5546d941e7bb13d8f">isClean</a>() &amp;&amp; !is_destination) {</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;            <span class="comment">// before snooping we need to make sure that the memory</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;            <span class="comment">// below is not busy and the cache clean request can be</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;            <span class="comment">// forwarded to it</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="classBaseXBar.html#a7121edb077f36aece2830ffae4dc2f2c">masterPorts</a>[master_port_id]-&gt;tryTiming(pkt)) {</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;                <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classCoherentXBar.html">CoherentXBar</a>, <span class="stringliteral">&quot;%s: src %s packet %s RETRY\n&quot;</span>, __func__,</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;                        src_port-&gt;<a class="code" href="classPort.html#a18a1938a97583fef5c9cb8433df30ceb">name</a>(), pkt-&gt;<a class="code" href="classPacket.html#a7a19b40cc01e43c41bc99fb7fadb89ea">print</a>());</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                <span class="comment">// update the layer state and schedule an idle event</span></div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                <a class="code" href="classCoherentXBar.html#a5b967590159ab1144f26e244bd3b9c2a">reqLayers</a>[master_port_id]-&gt;failedTiming(src_port,</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                                                        <a class="code" href="classClocked.html#a082ec89d11f90b11b91ba7876040e41e">clockEdge</a>(<a class="code" href="classCycles.html">Cycles</a>(1)));</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;            }</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        }</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        <span class="comment">// the packet is a memory-mapped request and should be</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        <span class="comment">// broadcasted to our snoopers but the source</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classCoherentXBar.html#a9f9454818f672a40a28538c8b8496633">snoopFilter</a>) {</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;            <span class="comment">// check with the snoop filter where to forward this packet</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;            <span class="keyword">auto</span> sf_res = <a class="code" href="classCoherentXBar.html#a9f9454818f672a40a28538c8b8496633">snoopFilter</a>-&gt;<a class="code" href="classSnoopFilter.html#a9bdd8986f9d76c9e86be279d1353c0c8">lookupRequest</a>(pkt, *src_port);</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;            <span class="comment">// the time required by a packet to be delivered through</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;            <span class="comment">// the xbar has to be charged also with to lookup latency</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;            <span class="comment">// of the snoop filter</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;            pkt-&gt;<a class="code" href="classPacket.html#ae035c719eee7a7713ab831a11e9e7406">headerDelay</a> += sf_res.second * <a class="code" href="classClocked.html#aa7fa265550d8232e766522699ca8fa38">clockPeriod</a>();</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;            <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classCoherentXBar.html">CoherentXBar</a>, <span class="stringliteral">&quot;%s: src %s packet %s SF size: %i lat: %i\n&quot;</span>,</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;                    __func__, src_port-&gt;<a class="code" href="classPort.html#a18a1938a97583fef5c9cb8433df30ceb">name</a>(), pkt-&gt;<a class="code" href="classPacket.html#a7a19b40cc01e43c41bc99fb7fadb89ea">print</a>(),</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;                    sf_res.first.size(), sf_res.second);</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;            <span class="keywordflow">if</span> (pkt-&gt;<a class="code" href="classPacket.html#aee3d51b535ec42973453f5584dc16cb6">isEviction</a>()) {</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;                <span class="comment">// for block-evicting packets, i.e. writebacks and</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                <span class="comment">// clean evictions, there is no need to snoop up, as</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                <span class="comment">// all we do is determine if the block is cached or</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                <span class="comment">// not, instead just set it here based on the snoop</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                <span class="comment">// filter result</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                <span class="keywordflow">if</span> (!sf_res.first.empty())</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                    pkt-&gt;<a class="code" href="classPacket.html#a4ed3d512e1660940c23561a0605f2ab3">setBlockCached</a>();</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                <a class="code" href="classCoherentXBar.html#afc0e823057dd03d2cde717ad1f0f56b2">forwardTiming</a>(pkt, slave_port_id, sf_res.first);</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;            }</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;            <a class="code" href="classCoherentXBar.html#afc0e823057dd03d2cde717ad1f0f56b2">forwardTiming</a>(pkt, slave_port_id);</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        }</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        <span class="comment">// add the snoop delay to our header delay, and then reset it</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        pkt-&gt;<a class="code" href="classPacket.html#ae035c719eee7a7713ab831a11e9e7406">headerDelay</a> += pkt-&gt;<a class="code" href="classPacket.html#a5e4a9b04aa6384293ff44918805cdc02">snoopDelay</a>;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        pkt-&gt;<a class="code" href="classPacket.html#a5e4a9b04aa6384293ff44918805cdc02">snoopDelay</a> = 0;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    }</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="comment">// set up a sensible starting point</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    <span class="keywordtype">bool</span> success = <span class="keyword">true</span>;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <span class="comment">// remember if the packet will generate a snoop response by</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <span class="comment">// checking if a cache set the cacheResponding flag during the</span></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <span class="comment">// snooping above</span></div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> expect_snoop_resp = !cache_responding &amp;&amp; pkt-&gt;<a class="code" href="classPacket.html#a14141460ec6de11c61eb6dc2ab5eda8f">cacheResponding</a>();</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <span class="keywordtype">bool</span> expect_response = pkt-&gt;<a class="code" href="classPacket.html#abb255770a0a1278960af6ffa1e0ceb64">needsResponse</a>() &amp;&amp; !pkt-&gt;<a class="code" href="classPacket.html#a14141460ec6de11c61eb6dc2ab5eda8f">cacheResponding</a>();</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> sink_packet = <a class="code" href="classCoherentXBar.html#a2951d332bccd3c06adb0d087cd44e7b3">sinkPacket</a>(pkt);</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <span class="comment">// in certain cases the crossbar is responsible for responding</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <span class="keywordtype">bool</span> respond_directly = <span class="keyword">false</span>;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <span class="comment">// store the original address as an address mapper could possibly</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="comment">// modify the address upon a sendTimingRequest</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <span class="keyword">const</span> <a class="code" href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a> <a class="code" href="inet_8hh.html#ae32b25ff633168fbdecd8d24293034cd">addr</a>(pkt-&gt;<a class="code" href="classPacket.html#a5d8b9bb469e6879c03c73effe3640634">getAddr</a>());</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <span class="keywordflow">if</span> (sink_packet) {</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;        <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classCoherentXBar.html">CoherentXBar</a>, <span class="stringliteral">&quot;%s: Not forwarding %s\n&quot;</span>, __func__,</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                pkt-&gt;<a class="code" href="classPacket.html#a7a19b40cc01e43c41bc99fb7fadb89ea">print</a>());</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        <span class="comment">// determine if we are forwarding the packet, or responding to</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        <span class="comment">// it</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classCoherentXBar.html#a726c05f4a169fa7f45d02221ba290731">forwardPacket</a>(pkt)) {</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;            <span class="comment">// if we are passing on, rather than sinking, a packet to</span></div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;            <span class="comment">// which an upstream cache has committed to responding,</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;            <span class="comment">// the line was needs writable, and the responding only</span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;            <span class="comment">// had an Owned copy, so we need to immidiately let the</span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;            <span class="comment">// downstream caches know, bypass any flow control</span></div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;            <span class="keywordflow">if</span> (pkt-&gt;<a class="code" href="classPacket.html#a14141460ec6de11c61eb6dc2ab5eda8f">cacheResponding</a>()) {</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                pkt-&gt;<a class="code" href="classPacket.html#a72bab6f4a0b9552b6555e57d0cf86b99">setExpressSnoop</a>();</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;            }</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;            <span class="comment">// make sure that the write request (e.g., WriteClean)</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;            <span class="comment">// will stop at the memory below if this crossbar is its</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;            <span class="comment">// destination</span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;            <span class="keywordflow">if</span> (pkt-&gt;<a class="code" href="classPacket.html#aec89f98657b94e77f4f7a3087dfe690c">isWrite</a>() &amp;&amp; is_destination) {</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;                pkt-&gt;<a class="code" href="classPacket.html#a68b7449d2290af366ffd6dd8f59ebe45">clearWriteThrough</a>();</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;            }</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;            <span class="comment">// since it is a normal request, attempt to send the packet</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;            success = <a class="code" href="classBaseXBar.html#a7121edb077f36aece2830ffae4dc2f2c">masterPorts</a>[master_port_id]-&gt;sendTimingReq(pkt);</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;            <span class="comment">// no need to forward, turn this packet around and respond</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;            <span class="comment">// directly</span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;            assert(pkt-&gt;<a class="code" href="classPacket.html#abb255770a0a1278960af6ffa1e0ceb64">needsResponse</a>());</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;            respond_directly = <span class="keyword">true</span>;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;            assert(!expect_snoop_resp);</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;            expect_response = <span class="keyword">false</span>;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        }</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    }</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classCoherentXBar.html#a9f9454818f672a40a28538c8b8496633">snoopFilter</a> &amp;&amp; snoop_caches) {</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;        <span class="comment">// Let the snoop filter know about the success of the send operation</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        <a class="code" href="classCoherentXBar.html#a9f9454818f672a40a28538c8b8496633">snoopFilter</a>-&gt;<a class="code" href="classSnoopFilter.html#a05df182b0fd03e934b5e39fbebf47cbd">finishRequest</a>(!success, <a class="code" href="inet_8hh.html#ae32b25ff633168fbdecd8d24293034cd">addr</a>, pkt-&gt;<a class="code" href="classPacket.html#aca85c7ecfa5461f6804ad4dbaec28b29">isSecure</a>());</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    }</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="comment">// check if we were successful in sending the packet onwards</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <span class="keywordflow">if</span> (!success)  {</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        <span class="comment">// express snoops should never be forced to retry</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;        assert(!is_express_snoop);</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        <span class="comment">// restore the header delay</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;        pkt-&gt;<a class="code" href="classPacket.html#ae035c719eee7a7713ab831a11e9e7406">headerDelay</a> = old_header_delay;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classCoherentXBar.html">CoherentXBar</a>, <span class="stringliteral">&quot;%s: src %s packet %s RETRY\n&quot;</span>, __func__,</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;                src_port-&gt;<a class="code" href="classPort.html#a18a1938a97583fef5c9cb8433df30ceb">name</a>(), pkt-&gt;<a class="code" href="classPacket.html#a7a19b40cc01e43c41bc99fb7fadb89ea">print</a>());</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        <span class="comment">// update the layer state and schedule an idle event</span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        <a class="code" href="classCoherentXBar.html#a5b967590159ab1144f26e244bd3b9c2a">reqLayers</a>[master_port_id]-&gt;failedTiming(src_port,</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;                                                <a class="code" href="classClocked.html#a082ec89d11f90b11b91ba7876040e41e">clockEdge</a>(<a class="code" href="classCycles.html">Cycles</a>(1)));</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;        <span class="comment">// express snoops currently bypass the crossbar state entirely</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        <span class="keywordflow">if</span> (!is_express_snoop) {</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;            <span class="comment">// if this particular request will generate a snoop</span></div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;            <span class="comment">// response</span></div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;            <span class="keywordflow">if</span> (expect_snoop_resp) {</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;                <span class="comment">// we should never have an exsiting request outstanding</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;                assert(<a class="code" href="classCoherentXBar.html#ae3f48c1b6472d0160a33bb36cfa72521">outstandingSnoop</a>.find(pkt-&gt;<a class="code" href="classPacket.html#ae348c208f0ffb3cf22f1f65a19c13c4f">req</a>) ==</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;                       <a class="code" href="classCoherentXBar.html#ae3f48c1b6472d0160a33bb36cfa72521">outstandingSnoop</a>.end());</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;                <a class="code" href="classCoherentXBar.html#ae3f48c1b6472d0160a33bb36cfa72521">outstandingSnoop</a>.insert(pkt-&gt;<a class="code" href="classPacket.html#ae348c208f0ffb3cf22f1f65a19c13c4f">req</a>);</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;                <span class="comment">// basic sanity check on the outstanding snoops</span></div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;                <a class="code" href="logging_8hh.html#af5c59b879d6a32dc657018ab3d30198f">panic_if</a>(<a class="code" href="classCoherentXBar.html#ae3f48c1b6472d0160a33bb36cfa72521">outstandingSnoop</a>.size() &gt; <a class="code" href="classCoherentXBar.html#a8c01a1b2745b03a6e57d7fb20c36be25">maxOutstandingSnoopCheck</a>,</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;                         <span class="stringliteral">&quot;%s: Outstanding snoop requests exceeded %d\n&quot;</span>,</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;                         <a class="code" href="classSimObject.html#ac6bf42a0c7d51f21477fc064f75178c1">name</a>(), <a class="code" href="classCoherentXBar.html#a8c01a1b2745b03a6e57d7fb20c36be25">maxOutstandingSnoopCheck</a>);</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;            }</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;            <span class="comment">// remember where to route the normal response to</span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;            <span class="keywordflow">if</span> (expect_response || expect_snoop_resp) {</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;                assert(<a class="code" href="classBaseXBar.html#a319d7d99f9c79b9959bfeb17f230cf7b">routeTo</a>.find(pkt-&gt;<a class="code" href="classPacket.html#ae348c208f0ffb3cf22f1f65a19c13c4f">req</a>) == <a class="code" href="classBaseXBar.html#a319d7d99f9c79b9959bfeb17f230cf7b">routeTo</a>.end());</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;                <a class="code" href="classBaseXBar.html#a319d7d99f9c79b9959bfeb17f230cf7b">routeTo</a>[pkt-&gt;<a class="code" href="classPacket.html#ae348c208f0ffb3cf22f1f65a19c13c4f">req</a>] = slave_port_id;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                <a class="code" href="logging_8hh.html#af5c59b879d6a32dc657018ab3d30198f">panic_if</a>(routeTo.size() &gt; <a class="code" href="classCoherentXBar.html#a22f47e8bf9304bae4534bc58192f9132">maxRoutingTableSizeCheck</a>,</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;                         <span class="stringliteral">&quot;%s: Routing table exceeds %d packets\n&quot;</span>,</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;                         <a class="code" href="classSimObject.html#ac6bf42a0c7d51f21477fc064f75178c1">name</a>(), <a class="code" href="classCoherentXBar.html#a22f47e8bf9304bae4534bc58192f9132">maxRoutingTableSizeCheck</a>);</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;            }</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;            <span class="comment">// update the layer state and schedule an idle event</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;            <a class="code" href="classCoherentXBar.html#a5b967590159ab1144f26e244bd3b9c2a">reqLayers</a>[master_port_id]-&gt;succeededTiming(packetFinishTime);</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        }</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        <span class="comment">// stats updates only consider packets that were successfully sent</span></div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        <a class="code" href="classBaseXBar.html#a69fb0712713b5ffa4a6f9f57397fd2d7">pktCount</a>[slave_port_id][master_port_id]++;</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        <a class="code" href="classBaseXBar.html#a247b474c367d5341b13814177e21ba8f">pktSize</a>[slave_port_id][master_port_id] += pkt_size;</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;        <a class="code" href="classBaseXBar.html#ab7eff749b4772ee3438917d04d94eaed">transDist</a>[pkt_cmd]++;</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;        <span class="keywordflow">if</span> (is_express_snoop) {</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;            <a class="code" href="classCoherentXBar.html#ae8842697fb1aa8204076bb4a80334b8c">snoops</a>++;</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;            <a class="code" href="classCoherentXBar.html#a2bf316f34a62913f6d95daeb1eac5e13">snoopTraffic</a> += pkt_size;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;        }</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    }</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    <span class="keywordflow">if</span> (sink_packet)</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        <span class="comment">// queue the packet for deletion</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        <a class="code" href="classCoherentXBar.html#a26aaa188267afcf9260c06bfbcd5ddc8">pendingDelete</a>.reset(pkt);</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <span class="comment">// normally we respond to the packet we just received if we need to</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <a class="code" href="classPacket.html">PacketPtr</a> rsp_pkt = pkt;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <a class="code" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a> rsp_port_id = slave_port_id;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    <span class="comment">// If this is the destination of the cache clean operation the</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    <span class="comment">// crossbar is responsible for responding. This crossbar will</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    <span class="comment">// respond when the cache clean is complete. A cache clean</span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <span class="comment">// is complete either:</span></div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <span class="comment">// * direcly, if no cache above had a dirty copy of the block</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    <span class="comment">//   as indicated by the satisfied flag of the packet, or</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    <span class="comment">// * when the crossbar has seen both the cache clean request</span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <span class="comment">//   (CleanSharedReq, CleanInvalidReq) and the corresponding</span></div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <span class="comment">//   write (WriteClean) which updates the block in the memory</span></div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <span class="comment">//   below.</span></div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    <span class="keywordflow">if</span> (success &amp;&amp;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;        ((pkt-&gt;<a class="code" href="classPacket.html#ad1382602367d7ce5546d941e7bb13d8f">isClean</a>() &amp;&amp; pkt-&gt;<a class="code" href="classPacket.html#a0db65d99eef3f53f20af61190883d741">satisfied</a>()) ||</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;         pkt-&gt;<a class="code" href="classPacket.html#ade61bff6cd470a7ce6376f3c85bdd3ae">cmd</a> == <a class="code" href="classMemCmd.html#ae5c39c2de0ad998b5176bc519b358102ab4e404a2679503dfab0a93913fe7960b">MemCmd::WriteClean</a>) &amp;&amp;</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;        is_destination) {</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;        <a class="code" href="classPacket.html">PacketPtr</a> deferred_rsp = pkt-&gt;<a class="code" href="classPacket.html#aec89f98657b94e77f4f7a3087dfe690c">isWrite</a>() ? nullptr : pkt;</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;        <span class="keyword">auto</span> cmo_lookup = <a class="code" href="classCoherentXBar.html#aa9774d2b647b71de873961873011f460">outstandingCMO</a>.find(pkt-&gt;<a class="code" href="classPacket.html#af720e740227e1083a16fc188cc7f22b4">id</a>);</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;        <span class="keywordflow">if</span> (cmo_lookup != <a class="code" href="classCoherentXBar.html#aa9774d2b647b71de873961873011f460">outstandingCMO</a>.end()) {</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;            <span class="comment">// the cache clean request has already reached this xbar</span></div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;            respond_directly = <span class="keyword">true</span>;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;            <span class="keywordflow">if</span> (pkt-&gt;<a class="code" href="classPacket.html#aec89f98657b94e77f4f7a3087dfe690c">isWrite</a>()) {</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;                rsp_pkt = cmo_lookup-&gt;second;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;                assert(rsp_pkt);</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;                <span class="comment">// determine the destination</span></div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;                <span class="keyword">const</span> <span class="keyword">auto</span> route_lookup = <a class="code" href="classBaseXBar.html#a319d7d99f9c79b9959bfeb17f230cf7b">routeTo</a>.find(rsp_pkt-&gt;<a class="code" href="classPacket.html#ae348c208f0ffb3cf22f1f65a19c13c4f">req</a>);</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;                assert(route_lookup != <a class="code" href="classBaseXBar.html#a319d7d99f9c79b9959bfeb17f230cf7b">routeTo</a>.end());</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;                rsp_port_id = route_lookup-&gt;second;</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;                assert(rsp_port_id != <a class="code" href="base_2types_8hh.html#a65bf40f138cf863f0c5e2d8ca1144126">InvalidPortID</a>);</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;                assert(rsp_port_id &lt; <a class="code" href="classCoherentXBar.html#aa8d178f10956856205fa921a76b64e30">respLayers</a>.size());</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;                <span class="comment">// remove the request from the routing table</span></div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;                <a class="code" href="classBaseXBar.html#a319d7d99f9c79b9959bfeb17f230cf7b">routeTo</a>.erase(route_lookup);</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;            }</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;            <a class="code" href="classCoherentXBar.html#aa9774d2b647b71de873961873011f460">outstandingCMO</a>.erase(cmo_lookup);</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;            respond_directly = <span class="keyword">false</span>;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;            <a class="code" href="classCoherentXBar.html#aa9774d2b647b71de873961873011f460">outstandingCMO</a>.emplace(pkt-&gt;<a class="code" href="classPacket.html#af720e740227e1083a16fc188cc7f22b4">id</a>, deferred_rsp);</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;            <span class="keywordflow">if</span> (!pkt-&gt;<a class="code" href="classPacket.html#aec89f98657b94e77f4f7a3087dfe690c">isWrite</a>()) {</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;                assert(<a class="code" href="classBaseXBar.html#a319d7d99f9c79b9959bfeb17f230cf7b">routeTo</a>.find(pkt-&gt;<a class="code" href="classPacket.html#ae348c208f0ffb3cf22f1f65a19c13c4f">req</a>) == <a class="code" href="classBaseXBar.html#a319d7d99f9c79b9959bfeb17f230cf7b">routeTo</a>.end());</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;                <a class="code" href="classBaseXBar.html#a319d7d99f9c79b9959bfeb17f230cf7b">routeTo</a>[pkt-&gt;<a class="code" href="classPacket.html#ae348c208f0ffb3cf22f1f65a19c13c4f">req</a>] = slave_port_id;</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;                <a class="code" href="logging_8hh.html#af5c59b879d6a32dc657018ab3d30198f">panic_if</a>(routeTo.size() &gt; <a class="code" href="classCoherentXBar.html#a22f47e8bf9304bae4534bc58192f9132">maxRoutingTableSizeCheck</a>,</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;                         <span class="stringliteral">&quot;%s: Routing table exceeds %d packets\n&quot;</span>,</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;                         <a class="code" href="classSimObject.html#ac6bf42a0c7d51f21477fc064f75178c1">name</a>(), <a class="code" href="classCoherentXBar.html#a22f47e8bf9304bae4534bc58192f9132">maxRoutingTableSizeCheck</a>);</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;            }</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;        }</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    }</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    <span class="keywordflow">if</span> (respond_directly) {</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        assert(rsp_pkt-&gt;<a class="code" href="classPacket.html#abb255770a0a1278960af6ffa1e0ceb64">needsResponse</a>());</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;        assert(success);</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;        rsp_pkt-&gt;<a class="code" href="classPacket.html#a51e1ba3f32ebb3c8be10cf9b58ca54e0">makeResponse</a>();</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classCoherentXBar.html#a9f9454818f672a40a28538c8b8496633">snoopFilter</a> &amp;&amp; !<a class="code" href="classCoherentXBar.html#a99e232a3411057cbefafe3e493fd342f">system</a>-&gt;<a class="code" href="classSystem.html#abc658a627235f9f0fee0a19fd34e43ab">bypassCaches</a>()) {</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;            <span class="comment">// let the snoop filter inspect the response and update its state</span></div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;            <a class="code" href="classCoherentXBar.html#a9f9454818f672a40a28538c8b8496633">snoopFilter</a>-&gt;<a class="code" href="classSnoopFilter.html#a918b564146c158716460f12726f2a08c">updateResponse</a>(rsp_pkt, *<a class="code" href="classBaseXBar.html#a636f80defcaea192d77f020ff0d83f9a">slavePorts</a>[rsp_port_id]);</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;        }</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;        <span class="comment">// we send the response after the current packet, even if the</span></div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;        <span class="comment">// response is not for this packet (e.g. cache clean operation</span></div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;        <span class="comment">// where both the request and the write packet have to cross</span></div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        <span class="comment">// the destination xbar before the response is sent.)</span></div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a> response_time = <a class="code" href="classClocked.html#a082ec89d11f90b11b91ba7876040e41e">clockEdge</a>() + pkt-&gt;<a class="code" href="classPacket.html#ae035c719eee7a7713ab831a11e9e7406">headerDelay</a>;</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;        rsp_pkt-&gt;<a class="code" href="classPacket.html#ae035c719eee7a7713ab831a11e9e7406">headerDelay</a> = 0;</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        <a class="code" href="classBaseXBar.html#a636f80defcaea192d77f020ff0d83f9a">slavePorts</a>[rsp_port_id]-&gt;schedTimingResp(rsp_pkt, response_time);</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    }</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <span class="keywordflow">return</span> success;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;}</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="keywordtype">bool</span></div><div class="line"><a name="l00444"></a><span class="lineno"><a class="line" href="classCoherentXBar.html#aae35f923360da4e14d780f55ae5dd4aa">  444</a></span>&#160;<a class="code" href="classCoherentXBar.html#aae35f923360da4e14d780f55ae5dd4aa">CoherentXBar::recvTimingResp</a>(<a class="code" href="classPacket.html">PacketPtr</a> pkt, <a class="code" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a> master_port_id)</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;{</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <span class="comment">// determine the source port based on the id</span></div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    <a class="code" href="classMasterPort.html">MasterPort</a> *src_port = <a class="code" href="classBaseXBar.html#a7121edb077f36aece2830ffae4dc2f2c">masterPorts</a>[master_port_id];</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <span class="comment">// determine the destination</span></div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> route_lookup = <a class="code" href="classBaseXBar.html#a319d7d99f9c79b9959bfeb17f230cf7b">routeTo</a>.find(pkt-&gt;<a class="code" href="classPacket.html#ae348c208f0ffb3cf22f1f65a19c13c4f">req</a>);</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    assert(route_lookup != <a class="code" href="classBaseXBar.html#a319d7d99f9c79b9959bfeb17f230cf7b">routeTo</a>.end());</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    <span class="keyword">const</span> <a class="code" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a> slave_port_id = route_lookup-&gt;second;</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    assert(slave_port_id != <a class="code" href="base_2types_8hh.html#a65bf40f138cf863f0c5e2d8ca1144126">InvalidPortID</a>);</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    assert(slave_port_id &lt; <a class="code" href="classCoherentXBar.html#aa8d178f10956856205fa921a76b64e30">respLayers</a>.size());</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    <span class="comment">// test if the crossbar should be considered occupied for the</span></div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    <span class="comment">// current port</span></div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="classCoherentXBar.html#aa8d178f10956856205fa921a76b64e30">respLayers</a>[slave_port_id]-&gt;tryTiming(src_port)) {</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classCoherentXBar.html">CoherentXBar</a>, <span class="stringliteral">&quot;%s: src %s packet %s BUSY\n&quot;</span>, __func__,</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;                src_port-&gt;<a class="code" href="classPort.html#a18a1938a97583fef5c9cb8433df30ceb">name</a>(), pkt-&gt;<a class="code" href="classPacket.html#a7a19b40cc01e43c41bc99fb7fadb89ea">print</a>());</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    }</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classCoherentXBar.html">CoherentXBar</a>, <span class="stringliteral">&quot;%s: src %s packet %s\n&quot;</span>, __func__,</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;            src_port-&gt;<a class="code" href="classPort.html#a18a1938a97583fef5c9cb8433df30ceb">name</a>(), pkt-&gt;<a class="code" href="classPacket.html#a7a19b40cc01e43c41bc99fb7fadb89ea">print</a>());</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    <span class="comment">// store size and command as they might be modified when</span></div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <span class="comment">// forwarding the packet</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pkt_size = pkt-&gt;<a class="code" href="classPacket.html#a389afe9616729132378ab8228a74441d">hasData</a>() ? pkt-&gt;<a class="code" href="classPacket.html#aaf1f26587ac7e1e5790b04931e35f64d">getSize</a>() : 0;</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pkt_cmd = pkt-&gt;<a class="code" href="classPacket.html#a14a73789b61dfcffbba858ea6210ef4c">cmdToIndex</a>();</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <span class="comment">// a response sees the response latency</span></div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a> xbar_delay = <a class="code" href="classBaseXBar.html#a0d84ca22facc7fb1e2dc39fef110dcfc">responseLatency</a> * <a class="code" href="classClocked.html#aa7fa265550d8232e766522699ca8fa38">clockPeriod</a>();</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    <span class="comment">// set the packet header and payload delay</span></div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    <a class="code" href="classBaseXBar.html#a91a7cf37c038ad1e1f741ae43b076566">calcPacketTiming</a>(pkt, xbar_delay);</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    <span class="comment">// determine how long to be crossbar layer is busy</span></div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a> packetFinishTime = <a class="code" href="classClocked.html#a082ec89d11f90b11b91ba7876040e41e">clockEdge</a>(<a class="code" href="classCycles.html">Cycles</a>(1)) + pkt-&gt;<a class="code" href="classPacket.html#a672f63108880c72376276d9ed01b3fc3">payloadDelay</a>;</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classCoherentXBar.html#a9f9454818f672a40a28538c8b8496633">snoopFilter</a> &amp;&amp; !<a class="code" href="classCoherentXBar.html#a99e232a3411057cbefafe3e493fd342f">system</a>-&gt;<a class="code" href="classSystem.html#abc658a627235f9f0fee0a19fd34e43ab">bypassCaches</a>()) {</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;        <span class="comment">// let the snoop filter inspect the response and update its state</span></div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;        <a class="code" href="classCoherentXBar.html#a9f9454818f672a40a28538c8b8496633">snoopFilter</a>-&gt;<a class="code" href="classSnoopFilter.html#a918b564146c158716460f12726f2a08c">updateResponse</a>(pkt, *<a class="code" href="classBaseXBar.html#a636f80defcaea192d77f020ff0d83f9a">slavePorts</a>[slave_port_id]);</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    }</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    <span class="comment">// send the packet through the destination slave port and pay for</span></div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    <span class="comment">// any outstanding header delay</span></div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a> latency = pkt-&gt;<a class="code" href="classPacket.html#ae035c719eee7a7713ab831a11e9e7406">headerDelay</a>;</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    pkt-&gt;<a class="code" href="classPacket.html#ae035c719eee7a7713ab831a11e9e7406">headerDelay</a> = 0;</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    <a class="code" href="classBaseXBar.html#a636f80defcaea192d77f020ff0d83f9a">slavePorts</a>[slave_port_id]-&gt;schedTimingResp(pkt, <a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22">curTick</a>() + latency);</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    <span class="comment">// remove the request from the routing table</span></div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    <a class="code" href="classBaseXBar.html#a319d7d99f9c79b9959bfeb17f230cf7b">routeTo</a>.erase(route_lookup);</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <a class="code" href="classCoherentXBar.html#aa8d178f10956856205fa921a76b64e30">respLayers</a>[slave_port_id]-&gt;succeededTiming(packetFinishTime);</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    <span class="comment">// stats updates</span></div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    <a class="code" href="classBaseXBar.html#a69fb0712713b5ffa4a6f9f57397fd2d7">pktCount</a>[slave_port_id][master_port_id]++;</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <a class="code" href="classBaseXBar.html#a247b474c367d5341b13814177e21ba8f">pktSize</a>[slave_port_id][master_port_id] += pkt_size;</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    <a class="code" href="classBaseXBar.html#ab7eff749b4772ee3438917d04d94eaed">transDist</a>[pkt_cmd]++;</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;}</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;<span class="keywordtype">void</span></div><div class="line"><a name="l00506"></a><span class="lineno"><a class="line" href="classCoherentXBar.html#a39752a3f16e31e5f64dccdd8e9db7731">  506</a></span>&#160;<a class="code" href="classCoherentXBar.html#a39752a3f16e31e5f64dccdd8e9db7731">CoherentXBar::recvTimingSnoopReq</a>(<a class="code" href="classPacket.html">PacketPtr</a> pkt, <a class="code" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a> master_port_id)</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;{</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classCoherentXBar.html">CoherentXBar</a>, <span class="stringliteral">&quot;%s: src %s packet %s\n&quot;</span>, __func__,</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;            <a class="code" href="classBaseXBar.html#a7121edb077f36aece2830ffae4dc2f2c">masterPorts</a>[master_port_id]-&gt;<a class="code" href="classSimObject.html#ac6bf42a0c7d51f21477fc064f75178c1">name</a>(), pkt-&gt;<a class="code" href="classPacket.html#a7a19b40cc01e43c41bc99fb7fadb89ea">print</a>());</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    <span class="comment">// update stats here as we know the forwarding will succeed</span></div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pkt_size = pkt-&gt;<a class="code" href="classPacket.html#a389afe9616729132378ab8228a74441d">hasData</a>() ? pkt-&gt;<a class="code" href="classPacket.html#aaf1f26587ac7e1e5790b04931e35f64d">getSize</a>() : 0;</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    <a class="code" href="classBaseXBar.html#ab7eff749b4772ee3438917d04d94eaed">transDist</a>[pkt-&gt;<a class="code" href="classPacket.html#a14a73789b61dfcffbba858ea6210ef4c">cmdToIndex</a>()]++;</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    <a class="code" href="classCoherentXBar.html#ae8842697fb1aa8204076bb4a80334b8c">snoops</a>++;</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    <a class="code" href="classCoherentXBar.html#a2bf316f34a62913f6d95daeb1eac5e13">snoopTraffic</a> += pkt_size;</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    <span class="comment">// we should only see express snoops from caches</span></div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    assert(pkt-&gt;<a class="code" href="classPacket.html#a4793369116c8c7782ed5033539c7f543">isExpressSnoop</a>());</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    <span class="comment">// set the packet header and payload delay, for now use forward latency</span></div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    <span class="comment">// @todo Assess the choice of latency further</span></div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    <a class="code" href="classBaseXBar.html#a91a7cf37c038ad1e1f741ae43b076566">calcPacketTiming</a>(pkt, <a class="code" href="classBaseXBar.html#af6aad4825ae3141ed0bac4c7b6a6fa23">forwardLatency</a> * <a class="code" href="classClocked.html#aa7fa265550d8232e766522699ca8fa38">clockPeriod</a>());</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    <span class="comment">// remember if a cache has already committed to responding so we</span></div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    <span class="comment">// can see if it changes during the snooping</span></div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> cache_responding = pkt-&gt;<a class="code" href="classPacket.html#a14141460ec6de11c61eb6dc2ab5eda8f">cacheResponding</a>();</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    assert(pkt-&gt;<a class="code" href="classPacket.html#a5e4a9b04aa6384293ff44918805cdc02">snoopDelay</a> == 0);</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classCoherentXBar.html#a9f9454818f672a40a28538c8b8496633">snoopFilter</a>) {</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;        <span class="comment">// let the Snoop Filter work its magic and guide probing</span></div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;        <span class="keyword">auto</span> sf_res = <a class="code" href="classCoherentXBar.html#a9f9454818f672a40a28538c8b8496633">snoopFilter</a>-&gt;<a class="code" href="classSnoopFilter.html#a11a53badbadcff6f5cab262c7d511270">lookupSnoop</a>(pkt);</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;        <span class="comment">// the time required by a packet to be delivered through</span></div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;        <span class="comment">// the xbar has to be charged also with to lookup latency</span></div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;        <span class="comment">// of the snoop filter</span></div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;        pkt-&gt;<a class="code" href="classPacket.html#ae035c719eee7a7713ab831a11e9e7406">headerDelay</a> += sf_res.second * <a class="code" href="classClocked.html#aa7fa265550d8232e766522699ca8fa38">clockPeriod</a>();</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;        <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classCoherentXBar.html">CoherentXBar</a>, <span class="stringliteral">&quot;%s: src %s packet %s SF size: %i lat: %i\n&quot;</span>,</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;                __func__, <a class="code" href="classBaseXBar.html#a7121edb077f36aece2830ffae4dc2f2c">masterPorts</a>[master_port_id]-&gt;<a class="code" href="classSimObject.html#ac6bf42a0c7d51f21477fc064f75178c1">name</a>(), pkt-&gt;<a class="code" href="classPacket.html#a7a19b40cc01e43c41bc99fb7fadb89ea">print</a>(),</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;                sf_res.first.size(), sf_res.second);</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;        <span class="comment">// forward to all snoopers</span></div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;        <a class="code" href="classCoherentXBar.html#afc0e823057dd03d2cde717ad1f0f56b2">forwardTiming</a>(pkt, <a class="code" href="base_2types_8hh.html#a65bf40f138cf863f0c5e2d8ca1144126">InvalidPortID</a>, sf_res.first);</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;        <a class="code" href="classCoherentXBar.html#afc0e823057dd03d2cde717ad1f0f56b2">forwardTiming</a>(pkt, <a class="code" href="base_2types_8hh.html#a65bf40f138cf863f0c5e2d8ca1144126">InvalidPortID</a>);</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    }</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    <span class="comment">// add the snoop delay to our header delay, and then reset it</span></div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    pkt-&gt;<a class="code" href="classPacket.html#ae035c719eee7a7713ab831a11e9e7406">headerDelay</a> += pkt-&gt;<a class="code" href="classPacket.html#a5e4a9b04aa6384293ff44918805cdc02">snoopDelay</a>;</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    pkt-&gt;<a class="code" href="classPacket.html#a5e4a9b04aa6384293ff44918805cdc02">snoopDelay</a> = 0;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    <span class="comment">// if we can expect a response, remember how to route it</span></div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    <span class="keywordflow">if</span> (!cache_responding &amp;&amp; pkt-&gt;<a class="code" href="classPacket.html#a14141460ec6de11c61eb6dc2ab5eda8f">cacheResponding</a>()) {</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;        assert(<a class="code" href="classBaseXBar.html#a319d7d99f9c79b9959bfeb17f230cf7b">routeTo</a>.find(pkt-&gt;<a class="code" href="classPacket.html#ae348c208f0ffb3cf22f1f65a19c13c4f">req</a>) == <a class="code" href="classBaseXBar.html#a319d7d99f9c79b9959bfeb17f230cf7b">routeTo</a>.end());</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;        <a class="code" href="classBaseXBar.html#a319d7d99f9c79b9959bfeb17f230cf7b">routeTo</a>[pkt-&gt;<a class="code" href="classPacket.html#ae348c208f0ffb3cf22f1f65a19c13c4f">req</a>] = master_port_id;</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    }</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    <span class="comment">// a snoop request came from a connected slave device (one of</span></div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    <span class="comment">// our master ports), and if it is not coming from the slave</span></div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    <span class="comment">// device responsible for the address range something is</span></div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    <span class="comment">// wrong, hence there is nothing further to do as the packet</span></div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    <span class="comment">// would be going back to where it came from</span></div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    assert(<a class="code" href="classBaseXBar.html#a727799d20d95a711af40fba377f26788">findPort</a>(pkt-&gt;<a class="code" href="classPacket.html#aa71d1ff754f712c337e8908a1595f8a0">getAddrRange</a>()) == master_port_id);</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;}</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;<span class="keywordtype">bool</span></div><div class="line"><a name="l00566"></a><span class="lineno"><a class="line" href="classCoherentXBar.html#ad1cb401cd12fbfd94a3a118fe72cf0cd">  566</a></span>&#160;<a class="code" href="classCoherentXBar.html#ad1cb401cd12fbfd94a3a118fe72cf0cd">CoherentXBar::recvTimingSnoopResp</a>(<a class="code" href="classPacket.html">PacketPtr</a> pkt, <a class="code" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a> slave_port_id)</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;{</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    <span class="comment">// determine the source port based on the id</span></div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    <a class="code" href="classSlavePort.html">SlavePort</a>* src_port = <a class="code" href="classBaseXBar.html#a636f80defcaea192d77f020ff0d83f9a">slavePorts</a>[slave_port_id];</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    <span class="comment">// get the destination</span></div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> route_lookup = <a class="code" href="classBaseXBar.html#a319d7d99f9c79b9959bfeb17f230cf7b">routeTo</a>.find(pkt-&gt;<a class="code" href="classPacket.html#ae348c208f0ffb3cf22f1f65a19c13c4f">req</a>);</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    assert(route_lookup != <a class="code" href="classBaseXBar.html#a319d7d99f9c79b9959bfeb17f230cf7b">routeTo</a>.end());</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    <span class="keyword">const</span> <a class="code" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a> dest_port_id = route_lookup-&gt;second;</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    assert(dest_port_id != <a class="code" href="base_2types_8hh.html#a65bf40f138cf863f0c5e2d8ca1144126">InvalidPortID</a>);</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    <span class="comment">// determine if the response is from a snoop request we</span></div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    <span class="comment">// created as the result of a normal request (in which case it</span></div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    <span class="comment">// should be in the outstandingSnoop), or if we merely forwarded</span></div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    <span class="comment">// someone else&#39;s snoop request</span></div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> forwardAsSnoop = <a class="code" href="classCoherentXBar.html#ae3f48c1b6472d0160a33bb36cfa72521">outstandingSnoop</a>.find(pkt-&gt;<a class="code" href="classPacket.html#ae348c208f0ffb3cf22f1f65a19c13c4f">req</a>) ==</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;        <a class="code" href="classCoherentXBar.html#ae3f48c1b6472d0160a33bb36cfa72521">outstandingSnoop</a>.end();</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    <span class="comment">// test if the crossbar should be considered occupied for the</span></div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    <span class="comment">// current port, note that the check is bypassed if the response</span></div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    <span class="comment">// is being passed on as a normal response since this is occupying</span></div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    <span class="comment">// the response layer rather than the snoop response layer</span></div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    <span class="keywordflow">if</span> (forwardAsSnoop) {</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;        assert(dest_port_id &lt; <a class="code" href="classCoherentXBar.html#acfd586ff5879edb3bc8e5281e4e1c728">snoopLayers</a>.size());</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="classCoherentXBar.html#acfd586ff5879edb3bc8e5281e4e1c728">snoopLayers</a>[dest_port_id]-&gt;tryTiming(src_port)) {</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;            <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classCoherentXBar.html">CoherentXBar</a>, <span class="stringliteral">&quot;%s: src %s packet %s BUSY\n&quot;</span>, __func__,</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;                    src_port-&gt;<a class="code" href="classPort.html#a18a1938a97583fef5c9cb8433df30ceb">name</a>(), pkt-&gt;<a class="code" href="classPacket.html#a7a19b40cc01e43c41bc99fb7fadb89ea">print</a>());</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;        }</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;        <span class="comment">// get the master port that mirrors this slave port internally</span></div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;        <a class="code" href="classMasterPort.html">MasterPort</a>* snoop_port = <a class="code" href="classCoherentXBar.html#ae4bc8dc8c57cf49cbe8f4e9b4820abc6">snoopRespPorts</a>[slave_port_id];</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;        assert(dest_port_id &lt; <a class="code" href="classCoherentXBar.html#aa8d178f10956856205fa921a76b64e30">respLayers</a>.size());</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="classCoherentXBar.html#aa8d178f10956856205fa921a76b64e30">respLayers</a>[dest_port_id]-&gt;tryTiming(snoop_port)) {</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;            <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classCoherentXBar.html">CoherentXBar</a>, <span class="stringliteral">&quot;%s: src %s packet %s BUSY\n&quot;</span>, __func__,</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;                    snoop_port-&gt;<a class="code" href="classPort.html#a18a1938a97583fef5c9cb8433df30ceb">name</a>(), pkt-&gt;<a class="code" href="classPacket.html#a7a19b40cc01e43c41bc99fb7fadb89ea">print</a>());</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;        }</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    }</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classCoherentXBar.html">CoherentXBar</a>, <span class="stringliteral">&quot;%s: src %s packet %s\n&quot;</span>, __func__,</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;            src_port-&gt;<a class="code" href="classPort.html#a18a1938a97583fef5c9cb8433df30ceb">name</a>(), pkt-&gt;<a class="code" href="classPacket.html#a7a19b40cc01e43c41bc99fb7fadb89ea">print</a>());</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    <span class="comment">// store size and command as they might be modified when</span></div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    <span class="comment">// forwarding the packet</span></div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pkt_size = pkt-&gt;<a class="code" href="classPacket.html#a389afe9616729132378ab8228a74441d">hasData</a>() ? pkt-&gt;<a class="code" href="classPacket.html#aaf1f26587ac7e1e5790b04931e35f64d">getSize</a>() : 0;</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pkt_cmd = pkt-&gt;<a class="code" href="classPacket.html#a14a73789b61dfcffbba858ea6210ef4c">cmdToIndex</a>();</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    <span class="comment">// responses are never express snoops</span></div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    assert(!pkt-&gt;<a class="code" href="classPacket.html#a4793369116c8c7782ed5033539c7f543">isExpressSnoop</a>());</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    <span class="comment">// a snoop response sees the snoop response latency, and if it is</span></div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    <span class="comment">// forwarded as a normal response, the response latency</span></div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a> xbar_delay =</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;        (forwardAsSnoop ? <a class="code" href="classCoherentXBar.html#ae17b2215cc8e1344fbe5f3a26760b3e0">snoopResponseLatency</a> : <a class="code" href="classBaseXBar.html#a0d84ca22facc7fb1e2dc39fef110dcfc">responseLatency</a>) *</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;        <a class="code" href="classClocked.html#aa7fa265550d8232e766522699ca8fa38">clockPeriod</a>();</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    <span class="comment">// set the packet header and payload delay</span></div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    <a class="code" href="classBaseXBar.html#a91a7cf37c038ad1e1f741ae43b076566">calcPacketTiming</a>(pkt, xbar_delay);</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    <span class="comment">// determine how long to be crossbar layer is busy</span></div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a> packetFinishTime = <a class="code" href="classClocked.html#a082ec89d11f90b11b91ba7876040e41e">clockEdge</a>(<a class="code" href="classCycles.html">Cycles</a>(1)) + pkt-&gt;<a class="code" href="classPacket.html#a672f63108880c72376276d9ed01b3fc3">payloadDelay</a>;</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    <span class="comment">// forward it either as a snoop response or a normal response</span></div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    <span class="keywordflow">if</span> (forwardAsSnoop) {</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;        <span class="comment">// this is a snoop response to a snoop request we forwarded,</span></div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;        <span class="comment">// e.g. coming from the L1 and going to the L2, and it should</span></div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;        <span class="comment">// be forwarded as a snoop response</span></div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classCoherentXBar.html#a9f9454818f672a40a28538c8b8496633">snoopFilter</a>) {</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;            <span class="comment">// update the probe filter so that it can properly track the line</span></div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;            <a class="code" href="classCoherentXBar.html#a9f9454818f672a40a28538c8b8496633">snoopFilter</a>-&gt;<a class="code" href="classSnoopFilter.html#aab16d00934fdd03be1339a0c0fd6f93e">updateSnoopForward</a>(pkt, *<a class="code" href="classBaseXBar.html#a636f80defcaea192d77f020ff0d83f9a">slavePorts</a>[slave_port_id],</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;                                            *<a class="code" href="classBaseXBar.html#a7121edb077f36aece2830ffae4dc2f2c">masterPorts</a>[dest_port_id]);</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;        }</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;        <span class="keywordtype">bool</span> success <a class="code" href="arch_2x86_2process_8cc.html#a4a522b8848c4afad8c6404708a44a05f">M5_VAR_USED</a> =</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;            <a class="code" href="classBaseXBar.html#a7121edb077f36aece2830ffae4dc2f2c">masterPorts</a>[dest_port_id]-&gt;sendTimingSnoopResp(pkt);</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;        <a class="code" href="classBaseXBar.html#a69fb0712713b5ffa4a6f9f57397fd2d7">pktCount</a>[slave_port_id][dest_port_id]++;</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;        <a class="code" href="classBaseXBar.html#a247b474c367d5341b13814177e21ba8f">pktSize</a>[slave_port_id][dest_port_id] += pkt_size;</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;        assert(success);</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;        <a class="code" href="classCoherentXBar.html#acfd586ff5879edb3bc8e5281e4e1c728">snoopLayers</a>[dest_port_id]-&gt;succeededTiming(packetFinishTime);</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;        <span class="comment">// we got a snoop response on one of our slave ports,</span></div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;        <span class="comment">// i.e. from a coherent master connected to the crossbar, and</span></div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;        <span class="comment">// since we created the snoop request as part of recvTiming,</span></div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;        <span class="comment">// this should now be a normal response again</span></div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;        <a class="code" href="classCoherentXBar.html#ae3f48c1b6472d0160a33bb36cfa72521">outstandingSnoop</a>.erase(pkt-&gt;<a class="code" href="classPacket.html#ae348c208f0ffb3cf22f1f65a19c13c4f">req</a>);</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;        <span class="comment">// this is a snoop response from a coherent master, hence it</span></div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;        <span class="comment">// should never go back to where the snoop response came from,</span></div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;        <span class="comment">// but instead to where the original request came from</span></div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;        assert(slave_port_id != dest_port_id);</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classCoherentXBar.html#a9f9454818f672a40a28538c8b8496633">snoopFilter</a>) {</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;            <span class="comment">// update the probe filter so that it can properly track the line</span></div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;            <a class="code" href="classCoherentXBar.html#a9f9454818f672a40a28538c8b8496633">snoopFilter</a>-&gt;<a class="code" href="classSnoopFilter.html#a783d60950d399d382b01d151b139f6ce">updateSnoopResponse</a>(pkt, *<a class="code" href="classBaseXBar.html#a636f80defcaea192d77f020ff0d83f9a">slavePorts</a>[slave_port_id],</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;                                    *<a class="code" href="classBaseXBar.html#a636f80defcaea192d77f020ff0d83f9a">slavePorts</a>[dest_port_id]);</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;        }</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;        <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classCoherentXBar.html">CoherentXBar</a>, <span class="stringliteral">&quot;%s: src %s packet %s FWD RESP\n&quot;</span>, __func__,</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;                src_port-&gt;<a class="code" href="classPort.html#a18a1938a97583fef5c9cb8433df30ceb">name</a>(), pkt-&gt;<a class="code" href="classPacket.html#a7a19b40cc01e43c41bc99fb7fadb89ea">print</a>());</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;        <span class="comment">// as a normal response, it should go back to a master through</span></div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;        <span class="comment">// one of our slave ports, we also pay for any outstanding</span></div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;        <span class="comment">// header latency</span></div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;        <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a> latency = pkt-&gt;<a class="code" href="classPacket.html#ae035c719eee7a7713ab831a11e9e7406">headerDelay</a>;</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;        pkt-&gt;<a class="code" href="classPacket.html#ae035c719eee7a7713ab831a11e9e7406">headerDelay</a> = 0;</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;        <a class="code" href="classBaseXBar.html#a636f80defcaea192d77f020ff0d83f9a">slavePorts</a>[dest_port_id]-&gt;schedTimingResp(pkt, <a class="code" href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22">curTick</a>() + latency);</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;        <a class="code" href="classCoherentXBar.html#aa8d178f10956856205fa921a76b64e30">respLayers</a>[dest_port_id]-&gt;succeededTiming(packetFinishTime);</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    }</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    <span class="comment">// remove the request from the routing table</span></div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    <a class="code" href="classBaseXBar.html#a319d7d99f9c79b9959bfeb17f230cf7b">routeTo</a>.erase(route_lookup);</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    <span class="comment">// stats updates</span></div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;    <a class="code" href="classBaseXBar.html#ab7eff749b4772ee3438917d04d94eaed">transDist</a>[pkt_cmd]++;</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    <a class="code" href="classCoherentXBar.html#ae8842697fb1aa8204076bb4a80334b8c">snoops</a>++;</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    <a class="code" href="classCoherentXBar.html#a2bf316f34a62913f6d95daeb1eac5e13">snoopTraffic</a> += pkt_size;</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;}</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;<span class="keywordtype">void</span></div><div class="line"><a name="l00692"></a><span class="lineno"><a class="line" href="classCoherentXBar.html#aa58c13e93d8f74fee4b2a19e3bbe1f7c">  692</a></span>&#160;<a class="code" href="classCoherentXBar.html#afc0e823057dd03d2cde717ad1f0f56b2">CoherentXBar::forwardTiming</a>(<a class="code" href="classPacket.html">PacketPtr</a> pkt, <a class="code" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a> exclude_slave_port_id,</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;                           <span class="keyword">const</span> <a class="code" href="classstd_1_1vector.html">std::vector&lt;QueuedSlavePort*&gt;</a>&amp; dests)</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;{</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classCoherentXBar.html">CoherentXBar</a>, <span class="stringliteral">&quot;%s for %s\n&quot;</span>, __func__, pkt-&gt;<a class="code" href="classPacket.html#a7a19b40cc01e43c41bc99fb7fadb89ea">print</a>());</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;    <span class="comment">// snoops should only happen if the system isn&#39;t bypassing caches</span></div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    assert(!<a class="code" href="classCoherentXBar.html#a99e232a3411057cbefafe3e493fd342f">system</a>-&gt;<a class="code" href="classSystem.html#abc658a627235f9f0fee0a19fd34e43ab">bypassCaches</a>());</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    <span class="keywordtype">unsigned</span> fanout = 0;</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code" href="namespaceMipsISA.html#ae12ae9e12fab22594609e2fefce7f7c2">p</a>: dests) {</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;        <span class="comment">// we could have gotten this request from a snooping master</span></div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;        <span class="comment">// (corresponding to our own slave port that is also in</span></div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;        <span class="comment">// snoopPorts) and should not send it back to where it came</span></div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;        <span class="comment">// from</span></div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;        <span class="keywordflow">if</span> (exclude_slave_port_id == <a class="code" href="base_2types_8hh.html#a65bf40f138cf863f0c5e2d8ca1144126">InvalidPortID</a> ||</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;            <a class="code" href="namespaceMipsISA.html#ae12ae9e12fab22594609e2fefce7f7c2">p</a>-&gt;getId() != exclude_slave_port_id) {</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;            <span class="comment">// cache is not allowed to refuse snoop</span></div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;            <a class="code" href="namespaceMipsISA.html#ae12ae9e12fab22594609e2fefce7f7c2">p</a>-&gt;sendTimingSnoopReq(pkt);</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;            fanout++;</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;        }</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    }</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    <span class="comment">// Stats for fanout of this forward operation</span></div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;    <a class="code" href="classCoherentXBar.html#aa88ce24d50d590d4150ac2833be7def5">snoopFanout</a>.<a class="code" href="classStats_1_1DistBase.html#af90c2e330c98bf517d3ad40265647e74">sample</a>(fanout);</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;}</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;<span class="keywordtype">void</span></div><div class="line"><a name="l00720"></a><span class="lineno"><a class="line" href="classCoherentXBar.html#add780d06c6c2cbc37ca9564f44039542">  720</a></span>&#160;<a class="code" href="classCoherentXBar.html#add780d06c6c2cbc37ca9564f44039542">CoherentXBar::recvReqRetry</a>(<a class="code" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a> master_port_id)</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;{</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;    <span class="comment">// responses and snoop responses never block on forwarding them,</span></div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;    <span class="comment">// so the retry will always be coming from a port to which we</span></div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;    <span class="comment">// tried to forward a request</span></div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    <a class="code" href="classCoherentXBar.html#a5b967590159ab1144f26e244bd3b9c2a">reqLayers</a>[master_port_id]-&gt;recvRetry();</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;}</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;<a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a></div><div class="line"><a name="l00729"></a><span class="lineno"><a class="line" href="classCoherentXBar.html#a6ad3a49a76453fdd1419af454bc28d70">  729</a></span>&#160;<a class="code" href="classCoherentXBar.html#a6ad3a49a76453fdd1419af454bc28d70">CoherentXBar::recvAtomicBackdoor</a>(<a class="code" href="classPacket.html">PacketPtr</a> pkt, <a class="code" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a> slave_port_id,</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;                                 <a class="code" href="classMemBackdoor.html">MemBackdoorPtr</a> *backdoor)</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;{</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classCoherentXBar.html">CoherentXBar</a>, <span class="stringliteral">&quot;%s: src %s packet %s\n&quot;</span>, __func__,</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;            <a class="code" href="classBaseXBar.html#a636f80defcaea192d77f020ff0d83f9a">slavePorts</a>[slave_port_id]-&gt;<a class="code" href="classSimObject.html#ac6bf42a0c7d51f21477fc064f75178c1">name</a>(), pkt-&gt;<a class="code" href="classPacket.html#a7a19b40cc01e43c41bc99fb7fadb89ea">print</a>());</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pkt_size = pkt-&gt;<a class="code" href="classPacket.html#a389afe9616729132378ab8228a74441d">hasData</a>() ? pkt-&gt;<a class="code" href="classPacket.html#aaf1f26587ac7e1e5790b04931e35f64d">getSize</a>() : 0;</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pkt_cmd = pkt-&gt;<a class="code" href="classPacket.html#a14a73789b61dfcffbba858ea6210ef4c">cmdToIndex</a>();</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;    <a class="code" href="classMemCmd.html">MemCmd</a> snoop_response_cmd = <a class="code" href="classMemCmd.html#ae5c39c2de0ad998b5176bc519b358102aefa7b894b47e6ffe03b70578c154b754">MemCmd::InvalidCmd</a>;</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;    <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a> snoop_response_latency = 0;</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    <span class="comment">// is this the destination point for this packet? (e.g. true if</span></div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;    <span class="comment">// this xbar is the PoC for a cache maintenance operation to the</span></div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;    <span class="comment">// PoC) otherwise the destination is any cache that can satisfy</span></div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;    <span class="comment">// the request</span></div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> is_destination = <a class="code" href="classCoherentXBar.html#a31f46d511a2a1753a1fd0e153cf71d39">isDestination</a>(pkt);</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> snoop_caches = !<a class="code" href="classCoherentXBar.html#a99e232a3411057cbefafe3e493fd342f">system</a>-&gt;<a class="code" href="classSystem.html#abc658a627235f9f0fee0a19fd34e43ab">bypassCaches</a>() &amp;&amp;</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;        pkt-&gt;<a class="code" href="classPacket.html#ade61bff6cd470a7ce6376f3c85bdd3ae">cmd</a> != <a class="code" href="classMemCmd.html#ae5c39c2de0ad998b5176bc519b358102ab4e404a2679503dfab0a93913fe7960b">MemCmd::WriteClean</a>;</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;    <span class="keywordflow">if</span> (snoop_caches) {</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;        <span class="comment">// forward to all snoopers but the source</span></div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;        <a class="code" href="classstd_1_1pair.html">std::pair&lt;MemCmd, Tick&gt;</a> snoop_result;</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classCoherentXBar.html#a9f9454818f672a40a28538c8b8496633">snoopFilter</a>) {</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;            <span class="comment">// check with the snoop filter where to forward this packet</span></div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;            <span class="keyword">auto</span> sf_res =</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;                <a class="code" href="classCoherentXBar.html#a9f9454818f672a40a28538c8b8496633">snoopFilter</a>-&gt;<a class="code" href="classSnoopFilter.html#a9bdd8986f9d76c9e86be279d1353c0c8">lookupRequest</a>(pkt, *<a class="code" href="classBaseXBar.html#a636f80defcaea192d77f020ff0d83f9a">slavePorts</a>[slave_port_id]);</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;            snoop_response_latency += sf_res.second * <a class="code" href="classClocked.html#aa7fa265550d8232e766522699ca8fa38">clockPeriod</a>();</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;            <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classCoherentXBar.html">CoherentXBar</a>, <span class="stringliteral">&quot;%s: src %s packet %s SF size: %i lat: %i\n&quot;</span>,</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;                    __func__, <a class="code" href="classBaseXBar.html#a636f80defcaea192d77f020ff0d83f9a">slavePorts</a>[slave_port_id]-&gt;<a class="code" href="classSimObject.html#ac6bf42a0c7d51f21477fc064f75178c1">name</a>(), pkt-&gt;<a class="code" href="classPacket.html#a7a19b40cc01e43c41bc99fb7fadb89ea">print</a>(),</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;                    sf_res.first.size(), sf_res.second);</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;            <span class="comment">// let the snoop filter know about the success of the send</span></div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;            <span class="comment">// operation, and do it even before sending it onwards to</span></div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;            <span class="comment">// avoid situations where atomic upward snoops sneak in</span></div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;            <span class="comment">// between and change the filter state</span></div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;            <a class="code" href="classCoherentXBar.html#a9f9454818f672a40a28538c8b8496633">snoopFilter</a>-&gt;<a class="code" href="classSnoopFilter.html#a05df182b0fd03e934b5e39fbebf47cbd">finishRequest</a>(<span class="keyword">false</span>, pkt-&gt;<a class="code" href="classPacket.html#a5d8b9bb469e6879c03c73effe3640634">getAddr</a>(), pkt-&gt;<a class="code" href="classPacket.html#aca85c7ecfa5461f6804ad4dbaec28b29">isSecure</a>());</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;            <span class="keywordflow">if</span> (pkt-&gt;<a class="code" href="classPacket.html#aee3d51b535ec42973453f5584dc16cb6">isEviction</a>()) {</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;                <span class="comment">// for block-evicting packets, i.e. writebacks and</span></div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;                <span class="comment">// clean evictions, there is no need to snoop up, as</span></div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;                <span class="comment">// all we do is determine if the block is cached or</span></div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;                <span class="comment">// not, instead just set it here based on the snoop</span></div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;                <span class="comment">// filter result</span></div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;                <span class="keywordflow">if</span> (!sf_res.first.empty())</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;                    pkt-&gt;<a class="code" href="classPacket.html#a4ed3d512e1660940c23561a0605f2ab3">setBlockCached</a>();</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;                snoop_result = <a class="code" href="classCoherentXBar.html#a38dc9251582760735568ea887761aa3b">forwardAtomic</a>(pkt, slave_port_id, <a class="code" href="base_2types_8hh.html#a65bf40f138cf863f0c5e2d8ca1144126">InvalidPortID</a>,</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;                                             sf_res.first);</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;            }</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;            snoop_result = <a class="code" href="classCoherentXBar.html#a38dc9251582760735568ea887761aa3b">forwardAtomic</a>(pkt, slave_port_id);</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;        }</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;        snoop_response_cmd = snoop_result.first;</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;        snoop_response_latency += snoop_result.second;</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;    }</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;    <span class="comment">// set up a sensible default value</span></div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;    <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a> response_latency = 0;</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> sink_packet = <a class="code" href="classCoherentXBar.html#a2951d332bccd3c06adb0d087cd44e7b3">sinkPacket</a>(pkt);</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    <span class="comment">// even if we had a snoop response, we must continue and also</span></div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    <span class="comment">// perform the actual request at the destination</span></div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    <a class="code" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a> master_port_id = <a class="code" href="classBaseXBar.html#a727799d20d95a711af40fba377f26788">findPort</a>(pkt-&gt;<a class="code" href="classPacket.html#aa71d1ff754f712c337e8908a1595f8a0">getAddrRange</a>());</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    <span class="keywordflow">if</span> (sink_packet) {</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;        <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classCoherentXBar.html">CoherentXBar</a>, <span class="stringliteral">&quot;%s: Not forwarding %s\n&quot;</span>, __func__,</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;                pkt-&gt;<a class="code" href="classPacket.html#a7a19b40cc01e43c41bc99fb7fadb89ea">print</a>());</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classCoherentXBar.html#a726c05f4a169fa7f45d02221ba290731">forwardPacket</a>(pkt)) {</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;            <span class="comment">// make sure that the write request (e.g., WriteClean)</span></div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;            <span class="comment">// will stop at the memory below if this crossbar is its</span></div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;            <span class="comment">// destination</span></div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;            <span class="keywordflow">if</span> (pkt-&gt;<a class="code" href="classPacket.html#aec89f98657b94e77f4f7a3087dfe690c">isWrite</a>() &amp;&amp; is_destination) {</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;                pkt-&gt;<a class="code" href="classPacket.html#a68b7449d2290af366ffd6dd8f59ebe45">clearWriteThrough</a>();</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;            }</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;            <span class="comment">// forward the request to the appropriate destination</span></div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;            <span class="keyword">auto</span> master = <a class="code" href="classBaseXBar.html#a7121edb077f36aece2830ffae4dc2f2c">masterPorts</a>[master_port_id];</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;            response_latency = backdoor ?</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;                master-&gt;sendAtomicBackdoor(pkt, *backdoor) :</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;                master-&gt;sendAtomic(pkt);</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;            <span class="comment">// if it does not need a response we sink the packet above</span></div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;            assert(pkt-&gt;<a class="code" href="classPacket.html#abb255770a0a1278960af6ffa1e0ceb64">needsResponse</a>());</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;            pkt-&gt;<a class="code" href="classPacket.html#a51e1ba3f32ebb3c8be10cf9b58ca54e0">makeResponse</a>();</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;        }</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    }</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;    <span class="comment">// stats updates for the request</span></div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    <a class="code" href="classBaseXBar.html#a69fb0712713b5ffa4a6f9f57397fd2d7">pktCount</a>[slave_port_id][master_port_id]++;</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    <a class="code" href="classBaseXBar.html#a247b474c367d5341b13814177e21ba8f">pktSize</a>[slave_port_id][master_port_id] += pkt_size;</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;    <a class="code" href="classBaseXBar.html#ab7eff749b4772ee3438917d04d94eaed">transDist</a>[pkt_cmd]++;</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;    <span class="comment">// if lower levels have replied, tell the snoop filter</span></div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="classCoherentXBar.html#a99e232a3411057cbefafe3e493fd342f">system</a>-&gt;<a class="code" href="classSystem.html#abc658a627235f9f0fee0a19fd34e43ab">bypassCaches</a>() &amp;&amp; <a class="code" href="classCoherentXBar.html#a9f9454818f672a40a28538c8b8496633">snoopFilter</a> &amp;&amp; pkt-&gt;<a class="code" href="classPacket.html#ae116431868d1c7f6b0dd127bbb7faeab">isResponse</a>()) {</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;        <a class="code" href="classCoherentXBar.html#a9f9454818f672a40a28538c8b8496633">snoopFilter</a>-&gt;<a class="code" href="classSnoopFilter.html#a918b564146c158716460f12726f2a08c">updateResponse</a>(pkt, *<a class="code" href="classBaseXBar.html#a636f80defcaea192d77f020ff0d83f9a">slavePorts</a>[slave_port_id]);</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;    }</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;    <span class="comment">// if we got a response from a snooper, restore it here</span></div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    <span class="keywordflow">if</span> (snoop_response_cmd != <a class="code" href="classMemCmd.html#ae5c39c2de0ad998b5176bc519b358102aefa7b894b47e6ffe03b70578c154b754">MemCmd::InvalidCmd</a>) {</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;        <span class="comment">// no one else should have responded</span></div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;        assert(!pkt-&gt;<a class="code" href="classPacket.html#ae116431868d1c7f6b0dd127bbb7faeab">isResponse</a>());</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;        pkt-&gt;<a class="code" href="classPacket.html#ade61bff6cd470a7ce6376f3c85bdd3ae">cmd</a> = snoop_response_cmd;</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;        response_latency = snoop_response_latency;</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;    }</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;    <span class="comment">// If this is the destination of the cache clean operation the</span></div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;    <span class="comment">// crossbar is responsible for responding. This crossbar will</span></div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;    <span class="comment">// respond when the cache clean is complete. An atomic cache clean</span></div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;    <span class="comment">// is complete when the crossbars receives the cache clean</span></div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;    <span class="comment">// request (CleanSharedReq, CleanInvalidReq), as either:</span></div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;    <span class="comment">// * no cache above had a dirty copy of the block as indicated by</span></div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;    <span class="comment">//   the satisfied flag of the packet, or</span></div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    <span class="comment">// * the crossbar has already seen the corresponding write</span></div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;    <span class="comment">//   (WriteClean) which updates the block in the memory below.</span></div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    <span class="keywordflow">if</span> (pkt-&gt;<a class="code" href="classPacket.html#ad1382602367d7ce5546d941e7bb13d8f">isClean</a>() &amp;&amp; <a class="code" href="classCoherentXBar.html#a31f46d511a2a1753a1fd0e153cf71d39">isDestination</a>(pkt) &amp;&amp; pkt-&gt;<a class="code" href="classPacket.html#a0db65d99eef3f53f20af61190883d741">satisfied</a>()) {</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;        <span class="keyword">auto</span> it = <a class="code" href="classCoherentXBar.html#aa9774d2b647b71de873961873011f460">outstandingCMO</a>.find(pkt-&gt;<a class="code" href="classPacket.html#af720e740227e1083a16fc188cc7f22b4">id</a>);</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;        assert(it != <a class="code" href="classCoherentXBar.html#aa9774d2b647b71de873961873011f460">outstandingCMO</a>.end());</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;        <span class="comment">// we are responding right away</span></div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;        <a class="code" href="classCoherentXBar.html#aa9774d2b647b71de873961873011f460">outstandingCMO</a>.erase(it);</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pkt-&gt;<a class="code" href="classPacket.html#ade61bff6cd470a7ce6376f3c85bdd3ae">cmd</a> == <a class="code" href="classMemCmd.html#ae5c39c2de0ad998b5176bc519b358102ab4e404a2679503dfab0a93913fe7960b">MemCmd::WriteClean</a> &amp;&amp; <a class="code" href="classCoherentXBar.html#a31f46d511a2a1753a1fd0e153cf71d39">isDestination</a>(pkt)) {</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;        <span class="comment">// if this is the destination of the operation, the xbar</span></div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;        <span class="comment">// sends the responce to the cache clean operation only</span></div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;        <span class="comment">// after having encountered the cache clean request</span></div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;        <span class="keyword">auto</span> <a class="code" href="arch_2x86_2process_8cc.html#a4a522b8848c4afad8c6404708a44a05f">M5_VAR_USED</a> ret = <a class="code" href="classCoherentXBar.html#aa9774d2b647b71de873961873011f460">outstandingCMO</a>.emplace(pkt-&gt;<a class="code" href="classPacket.html#af720e740227e1083a16fc188cc7f22b4">id</a>, <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;        <span class="comment">// in atomic mode we know that the WriteClean packet should</span></div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;        <span class="comment">// precede the clean request</span></div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;        assert(ret.second);</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;    }</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    <span class="comment">// add the response data</span></div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;    <span class="keywordflow">if</span> (pkt-&gt;<a class="code" href="classPacket.html#ae116431868d1c7f6b0dd127bbb7faeab">isResponse</a>()) {</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;        pkt_size = pkt-&gt;<a class="code" href="classPacket.html#a389afe9616729132378ab8228a74441d">hasData</a>() ? pkt-&gt;<a class="code" href="classPacket.html#aaf1f26587ac7e1e5790b04931e35f64d">getSize</a>() : 0;</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;        pkt_cmd = pkt-&gt;<a class="code" href="classPacket.html#a14a73789b61dfcffbba858ea6210ef4c">cmdToIndex</a>();</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;        <span class="comment">// stats updates</span></div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;        <a class="code" href="classBaseXBar.html#a69fb0712713b5ffa4a6f9f57397fd2d7">pktCount</a>[slave_port_id][master_port_id]++;</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;        <a class="code" href="classBaseXBar.html#a247b474c367d5341b13814177e21ba8f">pktSize</a>[slave_port_id][master_port_id] += pkt_size;</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;        <a class="code" href="classBaseXBar.html#ab7eff749b4772ee3438917d04d94eaed">transDist</a>[pkt_cmd]++;</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;    }</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;    <span class="comment">// @todo: Not setting header time</span></div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;    pkt-&gt;<a class="code" href="classPacket.html#a672f63108880c72376276d9ed01b3fc3">payloadDelay</a> = response_latency;</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;    <span class="keywordflow">return</span> response_latency;</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;}</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;<a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a></div><div class="line"><a name="l00880"></a><span class="lineno"><a class="line" href="classCoherentXBar.html#a8084244fa4dfb611dec054a4b437e1f9">  880</a></span>&#160;<a class="code" href="classCoherentXBar.html#a8084244fa4dfb611dec054a4b437e1f9">CoherentXBar::recvAtomicSnoop</a>(<a class="code" href="classPacket.html">PacketPtr</a> pkt, <a class="code" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a> master_port_id)</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;{</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;    <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classCoherentXBar.html">CoherentXBar</a>, <span class="stringliteral">&quot;%s: src %s packet %s\n&quot;</span>, __func__,</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;            <a class="code" href="classBaseXBar.html#a7121edb077f36aece2830ffae4dc2f2c">masterPorts</a>[master_port_id]-&gt;<a class="code" href="classSimObject.html#ac6bf42a0c7d51f21477fc064f75178c1">name</a>(), pkt-&gt;<a class="code" href="classPacket.html#a7a19b40cc01e43c41bc99fb7fadb89ea">print</a>());</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;    <span class="comment">// add the request snoop data</span></div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pkt_size = pkt-&gt;<a class="code" href="classPacket.html#a389afe9616729132378ab8228a74441d">hasData</a>() ? pkt-&gt;<a class="code" href="classPacket.html#aaf1f26587ac7e1e5790b04931e35f64d">getSize</a>() : 0;</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;    <a class="code" href="classCoherentXBar.html#ae8842697fb1aa8204076bb4a80334b8c">snoops</a>++;</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;    <a class="code" href="classCoherentXBar.html#a2bf316f34a62913f6d95daeb1eac5e13">snoopTraffic</a> += pkt_size;</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;    <span class="comment">// forward to all snoopers</span></div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;    <a class="code" href="classstd_1_1pair.html">std::pair&lt;MemCmd, Tick&gt;</a> snoop_result;</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;    <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a> snoop_response_latency = 0;</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classCoherentXBar.html#a9f9454818f672a40a28538c8b8496633">snoopFilter</a>) {</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;        <span class="keyword">auto</span> sf_res = <a class="code" href="classCoherentXBar.html#a9f9454818f672a40a28538c8b8496633">snoopFilter</a>-&gt;<a class="code" href="classSnoopFilter.html#a11a53badbadcff6f5cab262c7d511270">lookupSnoop</a>(pkt);</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;        snoop_response_latency += sf_res.second * <a class="code" href="classClocked.html#aa7fa265550d8232e766522699ca8fa38">clockPeriod</a>();</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;        <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classCoherentXBar.html">CoherentXBar</a>, <span class="stringliteral">&quot;%s: src %s packet %s SF size: %i lat: %i\n&quot;</span>,</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;                __func__, <a class="code" href="classBaseXBar.html#a7121edb077f36aece2830ffae4dc2f2c">masterPorts</a>[master_port_id]-&gt;<a class="code" href="classSimObject.html#ac6bf42a0c7d51f21477fc064f75178c1">name</a>(), pkt-&gt;<a class="code" href="classPacket.html#a7a19b40cc01e43c41bc99fb7fadb89ea">print</a>(),</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;                sf_res.first.size(), sf_res.second);</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;        snoop_result = <a class="code" href="classCoherentXBar.html#a38dc9251582760735568ea887761aa3b">forwardAtomic</a>(pkt, <a class="code" href="base_2types_8hh.html#a65bf40f138cf863f0c5e2d8ca1144126">InvalidPortID</a>, master_port_id,</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;                                     sf_res.first);</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;        snoop_result = <a class="code" href="classCoherentXBar.html#a38dc9251582760735568ea887761aa3b">forwardAtomic</a>(pkt, <a class="code" href="base_2types_8hh.html#a65bf40f138cf863f0c5e2d8ca1144126">InvalidPortID</a>);</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;    }</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;    <a class="code" href="classMemCmd.html">MemCmd</a> snoop_response_cmd = snoop_result.first;</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;    snoop_response_latency += snoop_result.second;</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;    <span class="keywordflow">if</span> (snoop_response_cmd != <a class="code" href="classMemCmd.html#ae5c39c2de0ad998b5176bc519b358102aefa7b894b47e6ffe03b70578c154b754">MemCmd::InvalidCmd</a>)</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;        pkt-&gt;<a class="code" href="classPacket.html#ade61bff6cd470a7ce6376f3c85bdd3ae">cmd</a> = snoop_response_cmd;</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;    <span class="comment">// add the response snoop data</span></div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;    <span class="keywordflow">if</span> (pkt-&gt;<a class="code" href="classPacket.html#ae116431868d1c7f6b0dd127bbb7faeab">isResponse</a>()) {</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;        <a class="code" href="classCoherentXBar.html#ae8842697fb1aa8204076bb4a80334b8c">snoops</a>++;</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;    }</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;    <span class="comment">// @todo: Not setting header time</span></div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;    pkt-&gt;<a class="code" href="classPacket.html#a672f63108880c72376276d9ed01b3fc3">payloadDelay</a> = snoop_response_latency;</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;    <span class="keywordflow">return</span> snoop_response_latency;</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;}</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;<a class="code" href="classstd_1_1pair.html">std::pair&lt;MemCmd, Tick&gt;</a></div><div class="line"><a name="l00921"></a><span class="lineno"><a class="line" href="classCoherentXBar.html#a1d2a062462929b756da883e9238b1ee1">  921</a></span>&#160;<a class="code" href="classCoherentXBar.html#a38dc9251582760735568ea887761aa3b">CoherentXBar::forwardAtomic</a>(<a class="code" href="classPacket.html">PacketPtr</a> pkt, <a class="code" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a> exclude_slave_port_id,</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;                           <a class="code" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a> source_master_port_id,</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;                           <span class="keyword">const</span> <a class="code" href="classstd_1_1vector.html">std::vector&lt;QueuedSlavePort*&gt;</a>&amp; dests)</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;{</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;    <span class="comment">// the packet may be changed on snoops, record the original</span></div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;    <span class="comment">// command to enable us to restore it between snoops so that</span></div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;    <span class="comment">// additional snoops can take place properly</span></div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;    <a class="code" href="classMemCmd.html">MemCmd</a> orig_cmd = pkt-&gt;<a class="code" href="classPacket.html#ade61bff6cd470a7ce6376f3c85bdd3ae">cmd</a>;</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;    <a class="code" href="classMemCmd.html">MemCmd</a> snoop_response_cmd = <a class="code" href="classMemCmd.html#ae5c39c2de0ad998b5176bc519b358102aefa7b894b47e6ffe03b70578c154b754">MemCmd::InvalidCmd</a>;</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;    <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a> snoop_response_latency = 0;</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;    <span class="comment">// snoops should only happen if the system isn&#39;t bypassing caches</span></div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;    assert(!<a class="code" href="classCoherentXBar.html#a99e232a3411057cbefafe3e493fd342f">system</a>-&gt;<a class="code" href="classSystem.html#abc658a627235f9f0fee0a19fd34e43ab">bypassCaches</a>());</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;    <span class="keywordtype">unsigned</span> fanout = 0;</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code" href="namespaceMipsISA.html#ae12ae9e12fab22594609e2fefce7f7c2">p</a>: dests) {</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;        <span class="comment">// we could have gotten this request from a snooping master</span></div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;        <span class="comment">// (corresponding to our own slave port that is also in</span></div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;        <span class="comment">// snoopPorts) and should not send it back to where it came</span></div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;        <span class="comment">// from</span></div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;        <span class="keywordflow">if</span> (exclude_slave_port_id != <a class="code" href="base_2types_8hh.html#a65bf40f138cf863f0c5e2d8ca1144126">InvalidPortID</a> &amp;&amp;</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;            <a class="code" href="namespaceMipsISA.html#ae12ae9e12fab22594609e2fefce7f7c2">p</a>-&gt;getId() == exclude_slave_port_id)</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;        <a class="code" href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a> latency = <a class="code" href="namespaceMipsISA.html#ae12ae9e12fab22594609e2fefce7f7c2">p</a>-&gt;sendAtomicSnoop(pkt);</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;        fanout++;</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;        <span class="comment">// in contrast to a functional access, we have to keep on</span></div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;        <span class="comment">// going as all snoopers must be updated even if we get a</span></div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;        <span class="comment">// response</span></div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;        <span class="keywordflow">if</span> (!pkt-&gt;<a class="code" href="classPacket.html#ae116431868d1c7f6b0dd127bbb7faeab">isResponse</a>())</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;        <span class="comment">// response from snoop agent</span></div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;        assert(pkt-&gt;<a class="code" href="classPacket.html#ade61bff6cd470a7ce6376f3c85bdd3ae">cmd</a> != orig_cmd);</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;        assert(pkt-&gt;<a class="code" href="classPacket.html#a14141460ec6de11c61eb6dc2ab5eda8f">cacheResponding</a>());</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;        <span class="comment">// should only happen once</span></div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;        assert(snoop_response_cmd == <a class="code" href="classMemCmd.html#ae5c39c2de0ad998b5176bc519b358102aefa7b894b47e6ffe03b70578c154b754">MemCmd::InvalidCmd</a>);</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;        <span class="comment">// save response state</span></div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;        snoop_response_cmd = pkt-&gt;<a class="code" href="classPacket.html#ade61bff6cd470a7ce6376f3c85bdd3ae">cmd</a>;</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;        snoop_response_latency = latency;</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classCoherentXBar.html#a9f9454818f672a40a28538c8b8496633">snoopFilter</a>) {</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;            <span class="comment">// Handle responses by the snoopers and differentiate between</span></div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;            <span class="comment">// responses to requests from above and snoops from below</span></div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;            <span class="keywordflow">if</span> (source_master_port_id != <a class="code" href="base_2types_8hh.html#a65bf40f138cf863f0c5e2d8ca1144126">InvalidPortID</a>) {</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;                <span class="comment">// Getting a response for a snoop from below</span></div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;                assert(exclude_slave_port_id == <a class="code" href="base_2types_8hh.html#a65bf40f138cf863f0c5e2d8ca1144126">InvalidPortID</a>);</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;                <a class="code" href="classCoherentXBar.html#a9f9454818f672a40a28538c8b8496633">snoopFilter</a>-&gt;<a class="code" href="classSnoopFilter.html#aab16d00934fdd03be1339a0c0fd6f93e">updateSnoopForward</a>(pkt, *<a class="code" href="namespaceMipsISA.html#ae12ae9e12fab22594609e2fefce7f7c2">p</a>,</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;                             *<a class="code" href="classBaseXBar.html#a7121edb077f36aece2830ffae4dc2f2c">masterPorts</a>[source_master_port_id]);</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;                <span class="comment">// Getting a response for a request from above</span></div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;                assert(source_master_port_id == <a class="code" href="base_2types_8hh.html#a65bf40f138cf863f0c5e2d8ca1144126">InvalidPortID</a>);</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;                <a class="code" href="classCoherentXBar.html#a9f9454818f672a40a28538c8b8496633">snoopFilter</a>-&gt;<a class="code" href="classSnoopFilter.html#a783d60950d399d382b01d151b139f6ce">updateSnoopResponse</a>(pkt, *<a class="code" href="namespaceMipsISA.html#ae12ae9e12fab22594609e2fefce7f7c2">p</a>,</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;                             *<a class="code" href="classBaseXBar.html#a636f80defcaea192d77f020ff0d83f9a">slavePorts</a>[exclude_slave_port_id]);</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;            }</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;        }</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;        <span class="comment">// restore original packet state for remaining snoopers</span></div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;        pkt-&gt;<a class="code" href="classPacket.html#ade61bff6cd470a7ce6376f3c85bdd3ae">cmd</a> = orig_cmd;</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;    }</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;    <span class="comment">// Stats for fanout</span></div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;    <a class="code" href="classCoherentXBar.html#aa88ce24d50d590d4150ac2833be7def5">snoopFanout</a>.<a class="code" href="classStats_1_1DistBase.html#af90c2e330c98bf517d3ad40265647e74">sample</a>(fanout);</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;    <span class="comment">// the packet is restored as part of the loop and any potential</span></div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;    <span class="comment">// snoop response is part of the returned pair</span></div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;    <span class="keywordflow">return</span> std::make_pair(snoop_response_cmd, snoop_response_latency);</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;}</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;<span class="keywordtype">void</span></div><div class="line"><a name="l00992"></a><span class="lineno"><a class="line" href="classCoherentXBar.html#a75ce7d1a83fe327be570029650e0c610">  992</a></span>&#160;<a class="code" href="classCoherentXBar.html#a75ce7d1a83fe327be570029650e0c610">CoherentXBar::recvFunctional</a>(<a class="code" href="classPacket.html">PacketPtr</a> pkt, <a class="code" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a> slave_port_id)</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;{</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;    <span class="keywordflow">if</span> (!pkt-&gt;<a class="code" href="classPacket.html#a60a4bf642d67ecbba475a400c0842066">isPrint</a>()) {</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;        <span class="comment">// don&#39;t do DPRINTFs on PrintReq as it clutters up the output</span></div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;        <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classCoherentXBar.html">CoherentXBar</a>, <span class="stringliteral">&quot;%s: src %s packet %s\n&quot;</span>, __func__,</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;                <a class="code" href="classBaseXBar.html#a636f80defcaea192d77f020ff0d83f9a">slavePorts</a>[slave_port_id]-&gt;<a class="code" href="classSimObject.html#ac6bf42a0c7d51f21477fc064f75178c1">name</a>(), pkt-&gt;<a class="code" href="classPacket.html#a7a19b40cc01e43c41bc99fb7fadb89ea">print</a>());</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;    }</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="classCoherentXBar.html#a99e232a3411057cbefafe3e493fd342f">system</a>-&gt;<a class="code" href="classSystem.html#abc658a627235f9f0fee0a19fd34e43ab">bypassCaches</a>()) {</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;        <span class="comment">// forward to all snoopers but the source</span></div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;        <a class="code" href="classCoherentXBar.html#a29d865089dc62927f3635540540ae499">forwardFunctional</a>(pkt, slave_port_id);</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;    }</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;    <span class="comment">// there is no need to continue if the snooping has found what we</span></div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;    <span class="comment">// were looking for and the packet is already a response</span></div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;    <span class="keywordflow">if</span> (!pkt-&gt;<a class="code" href="classPacket.html#ae116431868d1c7f6b0dd127bbb7faeab">isResponse</a>()) {</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;        <span class="comment">// since our slave ports are queued ports we need to check them as well</span></div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code" href="namespaceMipsISA.html#ae12ae9e12fab22594609e2fefce7f7c2">p</a> : <a class="code" href="classBaseXBar.html#a636f80defcaea192d77f020ff0d83f9a">slavePorts</a>) {</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;            <span class="comment">// if we find a response that has the data, then the</span></div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;            <span class="comment">// downstream caches/memories may be out of date, so simply stop</span></div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;            <span class="comment">// here</span></div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="namespaceMipsISA.html#ae12ae9e12fab22594609e2fefce7f7c2">p</a>-&gt;trySatisfyFunctional(pkt)) {</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;                <span class="keywordflow">if</span> (pkt-&gt;<a class="code" href="classPacket.html#abb255770a0a1278960af6ffa1e0ceb64">needsResponse</a>())</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;                    pkt-&gt;<a class="code" href="classPacket.html#a51e1ba3f32ebb3c8be10cf9b58ca54e0">makeResponse</a>();</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;                <span class="keywordflow">return</span>;</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;            }</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;        }</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;        <a class="code" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a> dest_id = <a class="code" href="classBaseXBar.html#a727799d20d95a711af40fba377f26788">findPort</a>(pkt-&gt;<a class="code" href="classPacket.html#aa71d1ff754f712c337e8908a1595f8a0">getAddrRange</a>());</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;        <a class="code" href="classBaseXBar.html#a7121edb077f36aece2830ffae4dc2f2c">masterPorts</a>[dest_id]-&gt;sendFunctional(pkt);</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;    }</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;}</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;<span class="keywordtype">void</span></div><div class="line"><a name="l01027"></a><span class="lineno"><a class="line" href="classCoherentXBar.html#a4fbe06103c3a49551d1ee5c8f0b693d2"> 1027</a></span>&#160;<a class="code" href="classCoherentXBar.html#a4fbe06103c3a49551d1ee5c8f0b693d2">CoherentXBar::recvFunctionalSnoop</a>(<a class="code" href="classPacket.html">PacketPtr</a> pkt, <a class="code" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a> master_port_id)</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;{</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;    <span class="keywordflow">if</span> (!pkt-&gt;<a class="code" href="classPacket.html#a60a4bf642d67ecbba475a400c0842066">isPrint</a>()) {</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;        <span class="comment">// don&#39;t do DPRINTFs on PrintReq as it clutters up the output</span></div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;        <a class="code" href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a>(<a class="code" href="classCoherentXBar.html">CoherentXBar</a>, <span class="stringliteral">&quot;%s: src %s packet %s\n&quot;</span>, __func__,</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;                <a class="code" href="classBaseXBar.html#a7121edb077f36aece2830ffae4dc2f2c">masterPorts</a>[master_port_id]-&gt;<a class="code" href="classSimObject.html#ac6bf42a0c7d51f21477fc064f75178c1">name</a>(), pkt-&gt;<a class="code" href="classPacket.html#a7a19b40cc01e43c41bc99fb7fadb89ea">print</a>());</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;    }</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code" href="namespaceMipsISA.html#ae12ae9e12fab22594609e2fefce7f7c2">p</a> : <a class="code" href="classBaseXBar.html#a636f80defcaea192d77f020ff0d83f9a">slavePorts</a>) {</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespaceMipsISA.html#ae12ae9e12fab22594609e2fefce7f7c2">p</a>-&gt;trySatisfyFunctional(pkt)) {</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;            <span class="keywordflow">if</span> (pkt-&gt;<a class="code" href="classPacket.html#abb255770a0a1278960af6ffa1e0ceb64">needsResponse</a>())</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;                pkt-&gt;<a class="code" href="classPacket.html#a51e1ba3f32ebb3c8be10cf9b58ca54e0">makeResponse</a>();</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;        }</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;    }</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;    <span class="comment">// forward to all snoopers</span></div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;    <a class="code" href="classCoherentXBar.html#a29d865089dc62927f3635540540ae499">forwardFunctional</a>(pkt, <a class="code" href="base_2types_8hh.html#a65bf40f138cf863f0c5e2d8ca1144126">InvalidPortID</a>);</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;}</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;<span class="keywordtype">void</span></div><div class="line"><a name="l01048"></a><span class="lineno"><a class="line" href="classCoherentXBar.html#a29d865089dc62927f3635540540ae499"> 1048</a></span>&#160;<a class="code" href="classCoherentXBar.html#a29d865089dc62927f3635540540ae499">CoherentXBar::forwardFunctional</a>(<a class="code" href="classPacket.html">PacketPtr</a> pkt, <a class="code" href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a> exclude_slave_port_id)</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;{</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;    <span class="comment">// snoops should only happen if the system isn&#39;t bypassing caches</span></div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;    assert(!<a class="code" href="classCoherentXBar.html#a99e232a3411057cbefafe3e493fd342f">system</a>-&gt;<a class="code" href="classSystem.html#abc658a627235f9f0fee0a19fd34e43ab">bypassCaches</a>());</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code" href="namespaceMipsISA.html#ae12ae9e12fab22594609e2fefce7f7c2">p</a>: <a class="code" href="classCoherentXBar.html#ade12b0118a2a220183b3392e0a2523f3">snoopPorts</a>) {</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;        <span class="comment">// we could have gotten this request from a snooping master</span></div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;        <span class="comment">// (corresponding to our own slave port that is also in</span></div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;        <span class="comment">// snoopPorts) and should not send it back to where it came</span></div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;        <span class="comment">// from</span></div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;        <span class="keywordflow">if</span> (exclude_slave_port_id == <a class="code" href="base_2types_8hh.html#a65bf40f138cf863f0c5e2d8ca1144126">InvalidPortID</a> ||</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;            <a class="code" href="namespaceMipsISA.html#ae12ae9e12fab22594609e2fefce7f7c2">p</a>-&gt;getId() != exclude_slave_port_id)</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;            <a class="code" href="namespaceMipsISA.html#ae12ae9e12fab22594609e2fefce7f7c2">p</a>-&gt;sendFunctionalSnoop(pkt);</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;        <span class="comment">// if we get a response we are done</span></div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;        <span class="keywordflow">if</span> (pkt-&gt;<a class="code" href="classPacket.html#ae116431868d1c7f6b0dd127bbb7faeab">isResponse</a>()) {</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;        }</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;    }</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;}</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;<span class="keywordtype">bool</span></div><div class="line"><a name="l01070"></a><span class="lineno"><a class="line" href="classCoherentXBar.html#a2951d332bccd3c06adb0d087cd44e7b3"> 1070</a></span>&#160;<a class="code" href="classCoherentXBar.html#a2951d332bccd3c06adb0d087cd44e7b3">CoherentXBar::sinkPacket</a>(<span class="keyword">const</span> <a class="code" href="classPacket.html">PacketPtr</a> pkt)<span class="keyword"> const</span></div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;    <span class="comment">// we can sink the packet if:</span></div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;    <span class="comment">// 1) the crossbar is the point of coherency, and a cache is</span></div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;    <span class="comment">//    responding after being snooped</span></div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;    <span class="comment">// 2) the crossbar is the point of coherency, and the packet is a</span></div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;    <span class="comment">//    coherency packet (not a read or a write) that does not</span></div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;    <span class="comment">//    require a response</span></div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;    <span class="comment">// 3) this is a clean evict or clean writeback, but the packet is</span></div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;    <span class="comment">//    found in a cache above this crossbar</span></div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;    <span class="comment">// 4) a cache is responding after being snooped, and the packet</span></div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;    <span class="comment">//    either does not need the block to be writable, or the cache</span></div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;    <span class="comment">//    that has promised to respond (setting the cache responding</span></div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;    <span class="comment">//    flag) is providing writable and thus had a Modified block,</span></div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;    <span class="comment">//    and no further action is needed</span></div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;    <span class="keywordflow">return</span> (<a class="code" href="classCoherentXBar.html#a11067b3bac038801be5f9bb9abc679bf">pointOfCoherency</a> &amp;&amp; pkt-&gt;<a class="code" href="classPacket.html#a14141460ec6de11c61eb6dc2ab5eda8f">cacheResponding</a>()) ||</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;        (<a class="code" href="classCoherentXBar.html#a11067b3bac038801be5f9bb9abc679bf">pointOfCoherency</a> &amp;&amp; !(pkt-&gt;<a class="code" href="classPacket.html#a1c89f5514a473f96561758b00c4a5e00">isRead</a>() || pkt-&gt;<a class="code" href="classPacket.html#aec89f98657b94e77f4f7a3087dfe690c">isWrite</a>()) &amp;&amp;</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;         !pkt-&gt;<a class="code" href="classPacket.html#abb255770a0a1278960af6ffa1e0ceb64">needsResponse</a>()) ||</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;        (pkt-&gt;<a class="code" href="classPacket.html#a40dd5b3ed1383009029c27edfaf24d07">isCleanEviction</a>() &amp;&amp; pkt-&gt;<a class="code" href="classPacket.html#a3184768b024571a5c3a4e6f36bdf5170">isBlockCached</a>()) ||</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;        (pkt-&gt;<a class="code" href="classPacket.html#a14141460ec6de11c61eb6dc2ab5eda8f">cacheResponding</a>() &amp;&amp;</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;         (!pkt-&gt;<a class="code" href="classPacket.html#a85a63311f59c1582ba8a4419e14dfb94">needsWritable</a>() || pkt-&gt;<a class="code" href="classPacket.html#a828c8eada6caef43d3b13ca739ebb961">responderHadWritable</a>()));</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;}</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;<span class="keywordtype">bool</span></div><div class="line"><a name="l01094"></a><span class="lineno"><a class="line" href="classCoherentXBar.html#a726c05f4a169fa7f45d02221ba290731"> 1094</a></span>&#160;<a class="code" href="classCoherentXBar.html#a726c05f4a169fa7f45d02221ba290731">CoherentXBar::forwardPacket</a>(<span class="keyword">const</span> <a class="code" href="classPacket.html">PacketPtr</a> pkt)</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;{</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;    <span class="comment">// we are forwarding the packet if:</span></div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;    <span class="comment">// 1) this is a cache clean request to the PoU/PoC and this</span></div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;    <span class="comment">//    crossbar is above the PoU/PoC</span></div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;    <span class="comment">// 2) this is a read or a write</span></div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;    <span class="comment">// 3) this crossbar is above the point of coherency</span></div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;    <span class="keywordflow">if</span> (pkt-&gt;<a class="code" href="classPacket.html#ad1382602367d7ce5546d941e7bb13d8f">isClean</a>()) {</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;        <span class="keywordflow">return</span> !<a class="code" href="classCoherentXBar.html#a31f46d511a2a1753a1fd0e153cf71d39">isDestination</a>(pkt);</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;    }</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;    <span class="keywordflow">return</span> pkt-&gt;<a class="code" href="classPacket.html#a1c89f5514a473f96561758b00c4a5e00">isRead</a>() || pkt-&gt;<a class="code" href="classPacket.html#aec89f98657b94e77f4f7a3087dfe690c">isWrite</a>() || !<a class="code" href="classCoherentXBar.html#a11067b3bac038801be5f9bb9abc679bf">pointOfCoherency</a>;</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;}</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;<span class="keywordtype">void</span></div><div class="line"><a name="l01109"></a><span class="lineno"><a class="line" href="classCoherentXBar.html#afd28320f6157ad949c85a56f680a9267"> 1109</a></span>&#160;<a class="code" href="classCoherentXBar.html#afd28320f6157ad949c85a56f680a9267">CoherentXBar::regStats</a>()</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;{</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;    <a class="code" href="classBaseXBar.html#a106a55433b5900d5225c1d026c5ef293">BaseXBar::regStats</a>();</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;    <a class="code" href="classCoherentXBar.html#aa88ce24d50d590d4150ac2833be7def5">snoopFanout</a>.<a class="code" href="classStats_1_1Distribution.html#a80326f47cdebeca2c5c86427d04c7e19">init</a>(0, <a class="code" href="classCoherentXBar.html#ade12b0118a2a220183b3392e0a2523f3">snoopPorts</a>.size(), 1);</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;}</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;<a class="code" href="classCoherentXBar.html">CoherentXBar</a> *</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;CoherentXBarParams::create()</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;{</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classCoherentXBar.html#a4c9ed4ae8ea2994335c52927ee205c89">CoherentXBar</a>(<span class="keyword">this</span>);</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;}</div><div class="ttc" id="classMasterPort_html"><div class="ttname"><a href="classMasterPort.html">MasterPort</a></div><div class="ttdoc">A MasterPort is a specialisation of a BaseMasterPort, which implements the default protocol for the t...</div><div class="ttdef"><b>Definition:</b> <a href="mem_2port_8hh_source.html#l00075">port.hh:75</a></div></div>
<div class="ttc" id="base_2trace_8hh_html_aefe58fddf89e41edd783bf4c3e31d2c3"><div class="ttname"><a href="base_2trace_8hh.html#aefe58fddf89e41edd783bf4c3e31d2c3">DPRINTF</a></div><div class="ttdeci">#define DPRINTF(x,...)</div><div class="ttdef"><b>Definition:</b> <a href="base_2trace_8hh_source.html#l00215">trace.hh:215</a></div></div>
<div class="ttc" id="classCoherentXBar_html_a9b7855d7f6292ed83f02a72021aab71e"><div class="ttname"><a href="classCoherentXBar.html#a9b7855d7f6292ed83f02a72021aab71e">CoherentXBar::~CoherentXBar</a></div><div class="ttdeci">virtual ~CoherentXBar()</div><div class="ttdef"><b>Definition:</b> <a href="coherent__xbar_8cc_source.html#l00110">coherent_xbar.cc:110</a></div></div>
<div class="ttc" id="classCoherentXBar_html_acfd586ff5879edb3bc8e5281e4e1c728"><div class="ttname"><a href="classCoherentXBar.html#acfd586ff5879edb3bc8e5281e4e1c728">CoherentXBar::snoopLayers</a></div><div class="ttdeci">std::vector&lt; SnoopRespLayer * &gt; snoopLayers</div><div class="ttdef"><b>Definition:</b> <a href="coherent__xbar_8hh_source.html#l00083">coherent_xbar.hh:83</a></div></div>
<div class="ttc" id="logging_8hh_html"><div class="ttname"><a href="logging_8hh.html">logging.hh</a></div></div>
<div class="ttc" id="classSnoopFilter_html_aab16d00934fdd03be1339a0c0fd6f93e"><div class="ttname"><a href="classSnoopFilter.html#aab16d00934fdd03be1339a0c0fd6f93e">SnoopFilter::updateSnoopForward</a></div><div class="ttdeci">void updateSnoopForward(const Packet *cpkt, const SlavePort &amp;rsp_port, const MasterPort &amp;req_port)</div><div class="ttdoc">Pass snoop responses that travel downward through the snoop filter and let them update the snoop filt...</div><div class="ttdef"><b>Definition:</b> <a href="snoop__filter_8cc_source.html#l00301">snoop_filter.cc:301</a></div></div>
<div class="ttc" id="classPacket_html_af720e740227e1083a16fc188cc7f22b4"><div class="ttname"><a href="classPacket.html#af720e740227e1083a16fc188cc7f22b4">Packet::id</a></div><div class="ttdeci">const PacketId id</div><div class="ttdef"><b>Definition:</b> <a href="packet_8hh_source.html#l00324">packet.hh:324</a></div></div>
<div class="ttc" id="classBaseXBar_1_1RespLayer_html"><div class="ttname"><a href="classBaseXBar_1_1RespLayer.html">BaseXBar::RespLayer</a></div><div class="ttdef"><b>Definition:</b> <a href="xbar_8hh_source.html#l00261">xbar.hh:261</a></div></div>
<div class="ttc" id="classPacket_html_a4793369116c8c7782ed5033539c7f543"><div class="ttname"><a href="classPacket.html#a4793369116c8c7782ed5033539c7f543">Packet::isExpressSnoop</a></div><div class="ttdeci">bool isExpressSnoop() const</div><div class="ttdef"><b>Definition:</b> <a href="packet_8hh_source.html#l00634">packet.hh:634</a></div></div>
<div class="ttc" id="classCycles_html"><div class="ttname"><a href="classCycles.html">Cycles</a></div><div class="ttdoc">Cycles is a wrapper class for representing cycle counts, i.e. </div><div class="ttdef"><b>Definition:</b> <a href="base_2types_8hh_source.html#l00083">types.hh:83</a></div></div>
<div class="ttc" id="classMemCmd_html"><div class="ttname"><a href="classMemCmd.html">MemCmd</a></div><div class="ttdef"><b>Definition:</b> <a href="packet_8hh_source.html#l00076">packet.hh:76</a></div></div>
<div class="ttc" id="classCoherentXBar_html_aa8d178f10956856205fa921a76b64e30"><div class="ttname"><a href="classCoherentXBar.html#aa8d178f10956856205fa921a76b64e30">CoherentXBar::respLayers</a></div><div class="ttdeci">std::vector&lt; RespLayer * &gt; respLayers</div><div class="ttdef"><b>Definition:</b> <a href="coherent__xbar_8hh_source.html#l00082">coherent_xbar.hh:82</a></div></div>
<div class="ttc" id="namespaceArmISA_html_a07402644ed55c19e1a116116c548c2ac"><div class="ttname"><a href="namespaceArmISA.html#a07402644ed55c19e1a116116c548c2ac">ArmISA::i</a></div><div class="ttdeci">Bitfield&lt; 7 &gt; i</div><div class="ttdef"><b>Definition:</b> <a href="miscregs__types_8hh_source.html#l00066">miscregs_types.hh:66</a></div></div>
<div class="ttc" id="base_2types_8hh_html_a65bf40f138cf863f0c5e2d8ca1144126"><div class="ttname"><a href="base_2types_8hh.html#a65bf40f138cf863f0c5e2d8ca1144126">InvalidPortID</a></div><div class="ttdeci">const PortID InvalidPortID</div><div class="ttdef"><b>Definition:</b> <a href="base_2types_8hh_source.html#l00238">types.hh:238</a></div></div>
<div class="ttc" id="classstd_1_1pair_html"><div class="ttname"><a href="classstd_1_1pair.html">std::pair</a></div><div class="ttdoc">STL pair class. </div><div class="ttdef"><b>Definition:</b> <a href="stl_8hh_source.html#l00061">stl.hh:61</a></div></div>
<div class="ttc" id="classSnoopFilter_html_a05df182b0fd03e934b5e39fbebf47cbd"><div class="ttname"><a href="classSnoopFilter.html#a05df182b0fd03e934b5e39fbebf47cbd">SnoopFilter::finishRequest</a></div><div class="ttdeci">void finishRequest(bool will_retry, Addr addr, bool is_secure)</div><div class="ttdoc">For an un-successful request, revert the change to the snoop filter. </div><div class="ttdef"><b>Definition:</b> <a href="snoop__filter_8cc_source.html#l00158">snoop_filter.cc:158</a></div></div>
<div class="ttc" id="classPacket_html_a5e4a9b04aa6384293ff44918805cdc02"><div class="ttname"><a href="classPacket.html#a5e4a9b04aa6384293ff44918805cdc02">Packet::snoopDelay</a></div><div class="ttdeci">uint32_t snoopDelay</div><div class="ttdoc">Keep track of the extra delay incurred by snooping upwards before sending a request down the memory s...</div><div class="ttdef"><b>Definition:</b> <a href="packet_8hh_source.html#l00374">packet.hh:374</a></div></div>
<div class="ttc" id="classCoherentXBar_html_a8c01a1b2745b03a6e57d7fb20c36be25"><div class="ttname"><a href="classCoherentXBar.html#a8c01a1b2745b03a6e57d7fb20c36be25">CoherentXBar::maxOutstandingSnoopCheck</a></div><div class="ttdeci">const unsigned int maxOutstandingSnoopCheck</div><div class="ttdoc">Maximum number of outstading snoops sanity check. </div><div class="ttdef"><b>Definition:</b> <a href="coherent__xbar_8hh_source.html#l00285">coherent_xbar.hh:285</a></div></div>
<div class="ttc" id="classPacket_html_a40dd5b3ed1383009029c27edfaf24d07"><div class="ttname"><a href="classPacket.html#a40dd5b3ed1383009029c27edfaf24d07">Packet::isCleanEviction</a></div><div class="ttdeci">bool isCleanEviction() const</div><div class="ttdoc">Is this packet a clean eviction, including both actual clean evict packets, but also clean writebacks...</div><div class="ttdef"><b>Definition:</b> <a href="packet_8hh_source.html#l01300">packet.hh:1300</a></div></div>
<div class="ttc" id="classCoherentXBar_html_a26aaa188267afcf9260c06bfbcd5ddc8"><div class="ttname"><a href="classCoherentXBar.html#a26aaa188267afcf9260c06bfbcd5ddc8">CoherentXBar::pendingDelete</a></div><div class="ttdeci">std::unique_ptr&lt; Packet &gt; pendingDelete</div><div class="ttdoc">Upstream caches need this packet until true is returned, so hold it for deletion until a subsequent c...</div><div class="ttdef"><b>Definition:</b> <a href="coherent__xbar_8hh_source.html#l00300">coherent_xbar.hh:300</a></div></div>
<div class="ttc" id="classBaseXBar_html_aaaec770d02c0625d3e471c7a99462537"><div class="ttname"><a href="classBaseXBar.html#aaaec770d02c0625d3e471c7a99462537">BaseXBar::defaultPortID</a></div><div class="ttdeci">PortID defaultPortID</div><div class="ttdoc">Port that handles requests that don&amp;#39;t match any of the interfaces. </div><div class="ttdef"><b>Definition:</b> <a href="xbar_8hh_source.html#l00382">xbar.hh:382</a></div></div>
<div class="ttc" id="inet_8hh_html_ae32b25ff633168fbdecd8d24293034cd"><div class="ttname"><a href="inet_8hh.html#ae32b25ff633168fbdecd8d24293034cd">addr</a></div><div class="ttdeci">ip6_addr_t addr</div><div class="ttdef"><b>Definition:</b> <a href="inet_8hh_source.html#l00335">inet.hh:335</a></div></div>
<div class="ttc" id="classPacket_html_ad1382602367d7ce5546d941e7bb13d8f"><div class="ttname"><a href="classPacket.html#ad1382602367d7ce5546d941e7bb13d8f">Packet::isClean</a></div><div class="ttdeci">bool isClean() const</div><div class="ttdef"><b>Definition:</b> <a href="packet_8hh_source.html#l00545">packet.hh:545</a></div></div>
<div class="ttc" id="classSnoopFilter_html_a06eeb117c6013133e4a62e005d6396b6"><div class="ttname"><a href="classSnoopFilter.html#a06eeb117c6013133e4a62e005d6396b6">SnoopFilter::setSlavePorts</a></div><div class="ttdeci">void setSlavePorts(const SnoopList &amp;slave_ports)</div><div class="ttdoc">Init a new snoop filter and tell it about all the slave ports of the enclosing bus. </div><div class="ttdef"><b>Definition:</b> <a href="snoop__filter_8hh_source.html#l00109">snoop_filter.hh:109</a></div></div>
<div class="ttc" id="classCoherentXBar_html_add780d06c6c2cbc37ca9564f44039542"><div class="ttname"><a href="classCoherentXBar.html#add780d06c6c2cbc37ca9564f44039542">CoherentXBar::recvReqRetry</a></div><div class="ttdeci">void recvReqRetry(PortID master_port_id)</div><div class="ttdef"><b>Definition:</b> <a href="coherent__xbar_8cc_source.html#l00720">coherent_xbar.cc:720</a></div></div>
<div class="ttc" id="classCoherentXBar_html_aa88ce24d50d590d4150ac2833be7def5"><div class="ttname"><a href="classCoherentXBar.html#aa88ce24d50d590d4150ac2833be7def5">CoherentXBar::snoopFanout</a></div><div class="ttdeci">Stats::Distribution snoopFanout</div><div class="ttdef"><b>Definition:</b> <a href="coherent__xbar_8hh_source.html#l00423">coherent_xbar.hh:423</a></div></div>
<div class="ttc" id="classBaseXBar_html_a319d7d99f9c79b9959bfeb17f230cf7b"><div class="ttname"><a href="classBaseXBar.html#a319d7d99f9c79b9959bfeb17f230cf7b">BaseXBar::routeTo</a></div><div class="ttdeci">std::unordered_map&lt; RequestPtr, PortID &gt; routeTo</div><div class="ttdoc">Remember where request packets came from so that we can route responses to the appropriate port...</div><div class="ttdef"><b>Definition:</b> <a href="xbar_8hh_source.html#l00326">xbar.hh:326</a></div></div>
<div class="ttc" id="classPacket_html_a14141460ec6de11c61eb6dc2ab5eda8f"><div class="ttname"><a href="classPacket.html#a14141460ec6de11c61eb6dc2ab5eda8f">Packet::cacheResponding</a></div><div class="ttdeci">bool cacheResponding() const</div><div class="ttdef"><b>Definition:</b> <a href="packet_8hh_source.html#l00591">packet.hh:591</a></div></div>
<div class="ttc" id="classCoherentXBar_1_1SnoopRespPort_html"><div class="ttname"><a href="classCoherentXBar_1_1SnoopRespPort.html">CoherentXBar::SnoopRespPort</a></div><div class="ttdoc">Internal class to bridge between an incoming snoop response from a slave port and forwarding it throu...</div><div class="ttdef"><b>Definition:</b> <a href="coherent__xbar_8hh_source.html#l00211">coherent_xbar.hh:211</a></div></div>
<div class="ttc" id="classBaseXBar_html_a0d84ca22facc7fb1e2dc39fef110dcfc"><div class="ttname"><a href="classBaseXBar.html#a0d84ca22facc7fb1e2dc39fef110dcfc">BaseXBar::responseLatency</a></div><div class="ttdeci">const Cycles responseLatency</div><div class="ttdef"><b>Definition:</b> <a href="xbar_8hh_source.html#l00314">xbar.hh:314</a></div></div>
<div class="ttc" id="classQueuedSlavePort_html"><div class="ttname"><a href="classQueuedSlavePort.html">QueuedSlavePort</a></div><div class="ttdoc">A queued port is a port that has an infinite queue for outgoing packets and thus decouples the module...</div><div class="ttdef"><b>Definition:</b> <a href="qport_8hh_source.html#l00060">qport.hh:60</a></div></div>
<div class="ttc" id="classSlavePort_html"><div class="ttname"><a href="classSlavePort.html">SlavePort</a></div><div class="ttdoc">A SlavePort is a specialisation of a port. </div><div class="ttdef"><b>Definition:</b> <a href="mem_2port_8hh_source.html#l00258">port.hh:258</a></div></div>
<div class="ttc" id="classCoherentXBar_html_a5b967590159ab1144f26e244bd3b9c2a"><div class="ttname"><a href="classCoherentXBar.html#a5b967590159ab1144f26e244bd3b9c2a">CoherentXBar::reqLayers</a></div><div class="ttdeci">std::vector&lt; ReqLayer * &gt; reqLayers</div><div class="ttdoc">Declare the layers of this crossbar, one vector for requests, one for responses, and one for snoop re...</div><div class="ttdef"><b>Definition:</b> <a href="coherent__xbar_8hh_source.html#l00081">coherent_xbar.hh:81</a></div></div>
<div class="ttc" id="classCoherentXBar_html_a2bf316f34a62913f6d95daeb1eac5e13"><div class="ttname"><a href="classCoherentXBar.html#a2bf316f34a62913f6d95daeb1eac5e13">CoherentXBar::snoopTraffic</a></div><div class="ttdeci">Stats::Scalar snoopTraffic</div><div class="ttdef"><b>Definition:</b> <a href="coherent__xbar_8hh_source.html#l00422">coherent_xbar.hh:422</a></div></div>
<div class="ttc" id="classCoherentXBar_html_ae17b2215cc8e1344fbe5f3a26760b3e0"><div class="ttname"><a href="classCoherentXBar.html#ae17b2215cc8e1344fbe5f3a26760b3e0">CoherentXBar::snoopResponseLatency</a></div><div class="ttdeci">const Cycles snoopResponseLatency</div><div class="ttdoc">Cycles of snoop response latency. </div><div class="ttdef"><b>Definition:</b> <a href="coherent__xbar_8hh_source.html#l00282">coherent_xbar.hh:282</a></div></div>
<div class="ttc" id="classCoherentXBar_html_a99e232a3411057cbefafe3e493fd342f"><div class="ttname"><a href="classCoherentXBar.html#a99e232a3411057cbefafe3e493fd342f">CoherentXBar::system</a></div><div class="ttdeci">System * system</div><div class="ttdoc">Keep a pointer to the system to be allow to querying memory system properties. </div><div class="ttdef"><b>Definition:</b> <a href="coherent__xbar_8hh_source.html#l00275">coherent_xbar.hh:275</a></div></div>
<div class="ttc" id="classClocked_html_aa7fa265550d8232e766522699ca8fa38"><div class="ttname"><a href="classClocked.html#aa7fa265550d8232e766522699ca8fa38">Clocked::clockPeriod</a></div><div class="ttdeci">Tick clockPeriod() const</div><div class="ttdef"><b>Definition:</b> <a href="clocked__object_8hh_source.html#l00220">clocked_object.hh:220</a></div></div>
<div class="ttc" id="classPacket_html_aec89f98657b94e77f4f7a3087dfe690c"><div class="ttname"><a href="classPacket.html#aec89f98657b94e77f4f7a3087dfe690c">Packet::isWrite</a></div><div class="ttdeci">bool isWrite() const</div><div class="ttdef"><b>Definition:</b> <a href="packet_8hh_source.html#l00529">packet.hh:529</a></div></div>
<div class="ttc" id="classCoherentXBar_1_1CoherentXBarSlavePort_html"><div class="ttname"><a href="classCoherentXBar_1_1CoherentXBarSlavePort.html">CoherentXBar::CoherentXBarSlavePort</a></div><div class="ttdoc">Declaration of the coherent crossbar slave port type, one will be instantiated for each of the master...</div><div class="ttdef"><b>Definition:</b> <a href="coherent__xbar_8hh_source.html#l00090">coherent_xbar.hh:90</a></div></div>
<div class="ttc" id="classCoherentXBar_html_ae3f48c1b6472d0160a33bb36cfa72521"><div class="ttname"><a href="classCoherentXBar.html#ae3f48c1b6472d0160a33bb36cfa72521">CoherentXBar::outstandingSnoop</a></div><div class="ttdeci">std::unordered_set&lt; RequestPtr &gt; outstandingSnoop</div><div class="ttdoc">Store the outstanding requests that we are expecting snoop responses from so we can determine which s...</div><div class="ttdef"><b>Definition:</b> <a href="coherent__xbar_8hh_source.html#l00262">coherent_xbar.hh:262</a></div></div>
<div class="ttc" id="classPacket_html_a1c89f5514a473f96561758b00c4a5e00"><div class="ttname"><a href="classPacket.html#a1c89f5514a473f96561758b00c4a5e00">Packet::isRead</a></div><div class="ttdeci">bool isRead() const</div><div class="ttdef"><b>Definition:</b> <a href="packet_8hh_source.html#l00528">packet.hh:528</a></div></div>
<div class="ttc" id="classCoherentXBar_html_a2951d332bccd3c06adb0d087cd44e7b3"><div class="ttname"><a href="classCoherentXBar.html#a2951d332bccd3c06adb0d087cd44e7b3">CoherentXBar::sinkPacket</a></div><div class="ttdeci">bool sinkPacket(const PacketPtr pkt) const</div><div class="ttdoc">Determine if the crossbar should sink the packet, as opposed to forwarding it, or responding...</div><div class="ttdef"><b>Definition:</b> <a href="coherent__xbar_8cc_source.html#l01070">coherent_xbar.cc:1070</a></div></div>
<div class="ttc" id="classstd_1_1vector_html"><div class="ttname"><a href="classstd_1_1vector.html">std::vector&lt; QueuedSlavePort * &gt;</a></div></div>
<div class="ttc" id="classCoherentXBar_html_a4fbe06103c3a49551d1ee5c8f0b693d2"><div class="ttname"><a href="classCoherentXBar.html#a4fbe06103c3a49551d1ee5c8f0b693d2">CoherentXBar::recvFunctionalSnoop</a></div><div class="ttdeci">void recvFunctionalSnoop(PacketPtr pkt, PortID master_port_id)</div><div class="ttdoc">Function called by the port when the crossbar is recieving a functional snoop transaction. </div><div class="ttdef"><b>Definition:</b> <a href="coherent__xbar_8cc_source.html#l01027">coherent_xbar.cc:1027</a></div></div>
<div class="ttc" id="classCoherentXBar_html_abaf0f43176c221e4546dca01aa7e43a8"><div class="ttname"><a href="classCoherentXBar.html#abaf0f43176c221e4546dca01aa7e43a8">CoherentXBar::recvTimingReq</a></div><div class="ttdeci">bool recvTimingReq(PacketPtr pkt, PortID slave_port_id)</div><div class="ttdef"><b>Definition:</b> <a href="coherent__xbar_8cc_source.html#l00147">coherent_xbar.cc:147</a></div></div>
<div class="ttc" id="base_2trace_8hh_html"><div class="ttname"><a href="base_2trace_8hh.html">trace.hh</a></div></div>
<div class="ttc" id="classPacket_html_a85a63311f59c1582ba8a4419e14dfb94"><div class="ttname"><a href="classPacket.html#a85a63311f59c1582ba8a4419e14dfb94">Packet::needsWritable</a></div><div class="ttdeci">bool needsWritable() const</div><div class="ttdef"><b>Definition:</b> <a href="packet_8hh_source.html#l00533">packet.hh:533</a></div></div>
<div class="ttc" id="classBaseXBar_html"><div class="ttname"><a href="classBaseXBar.html">BaseXBar</a></div><div class="ttdoc">The base crossbar contains the common elements of the non-coherent and coherent crossbar. </div><div class="ttdef"><b>Definition:</b> <a href="xbar_8hh_source.html#l00073">xbar.hh:73</a></div></div>
<div class="ttc" id="classSnoopFilter_html_a11a53badbadcff6f5cab262c7d511270"><div class="ttname"><a href="classSnoopFilter.html#a11a53badbadcff6f5cab262c7d511270">SnoopFilter::lookupSnoop</a></div><div class="ttdeci">std::pair&lt; SnoopList, Cycles &gt; lookupSnoop(const Packet *cpkt)</div><div class="ttdoc">Handle an incoming snoop from below (the master port). </div><div class="ttdef"><b>Definition:</b> <a href="snoop__filter_8cc_source.html#l00184">snoop_filter.cc:184</a></div></div>
<div class="ttc" id="classPacket_html_ae348c208f0ffb3cf22f1f65a19c13c4f"><div class="ttname"><a href="classPacket.html#ae348c208f0ffb3cf22f1f65a19c13c4f">Packet::req</a></div><div class="ttdeci">RequestPtr req</div><div class="ttdoc">A pointer to the original request. </div><div class="ttdef"><b>Definition:</b> <a href="packet_8hh_source.html#l00327">packet.hh:327</a></div></div>
<div class="ttc" id="classBaseXBar_html_a106a55433b5900d5225c1d026c5ef293"><div class="ttname"><a href="classBaseXBar.html#a106a55433b5900d5225c1d026c5ef293">BaseXBar::regStats</a></div><div class="ttdeci">void regStats() override</div><div class="ttdoc">Callback to set stat parameters. </div><div class="ttdef"><b>Definition:</b> <a href="xbar_8cc_source.html#l00540">xbar.cc:540</a></div></div>
<div class="ttc" id="classPacket_html_a3184768b024571a5c3a4e6f36bdf5170"><div class="ttname"><a href="classPacket.html#a3184768b024571a5c3a4e6f36bdf5170">Packet::isBlockCached</a></div><div class="ttdeci">bool isBlockCached() const</div><div class="ttdef"><b>Definition:</b> <a href="packet_8hh_source.html#l00692">packet.hh:692</a></div></div>
<div class="ttc" id="classMemBackdoor_html"><div class="ttname"><a href="classMemBackdoor.html">MemBackdoor</a></div><div class="ttdef"><b>Definition:</b> <a href="mem_2backdoor_8hh_source.html#l00040">backdoor.hh:40</a></div></div>
<div class="ttc" id="classPacket_html_aaf1f26587ac7e1e5790b04931e35f64d"><div class="ttname"><a href="classPacket.html#aaf1f26587ac7e1e5790b04931e35f64d">Packet::getSize</a></div><div class="ttdeci">unsigned getSize() const</div><div class="ttdef"><b>Definition:</b> <a href="packet_8hh_source.html#l00736">packet.hh:736</a></div></div>
<div class="ttc" id="classSimObject_html_a2a1c25d4de5184cccaca7f9b0b703a5d"><div class="ttname"><a href="classSimObject.html#a2a1c25d4de5184cccaca7f9b0b703a5d">SimObject::init</a></div><div class="ttdeci">virtual void init()</div><div class="ttdoc">init() is called after all C++ SimObjects have been created and all ports are connected. </div><div class="ttdef"><b>Definition:</b> <a href="sim__object_8cc_source.html#l00076">sim_object.cc:76</a></div></div>
<div class="ttc" id="statistics_8hh_html_a7acdccbf0d35ce0c159c0cdd36371b22"><div class="ttname"><a href="statistics_8hh.html#a7acdccbf0d35ce0c159c0cdd36371b22">curTick</a></div><div class="ttdeci">Tick curTick()</div><div class="ttdoc">The current simulated tick. </div><div class="ttdef"><b>Definition:</b> <a href="sim_2core_8hh_source.html#l00047">core.hh:47</a></div></div>
<div class="ttc" id="cprintf_8hh_html_a848c8ad3ab12f32c2d70d72701307be2"><div class="ttname"><a href="cprintf_8hh.html#a848c8ad3ab12f32c2d70d72701307be2">csprintf</a></div><div class="ttdeci">std::string csprintf(const char *format, const Args &amp;...args)</div><div class="ttdef"><b>Definition:</b> <a href="cprintf_8hh_source.html#l00162">cprintf.hh:162</a></div></div>
<div class="ttc" id="classPacket_html_abb255770a0a1278960af6ffa1e0ceb64"><div class="ttname"><a href="classPacket.html#abb255770a0a1278960af6ffa1e0ceb64">Packet::needsResponse</a></div><div class="ttdeci">bool needsResponse() const</div><div class="ttdef"><b>Definition:</b> <a href="packet_8hh_source.html#l00542">packet.hh:542</a></div></div>
<div class="ttc" id="classPacket_html_ae035c719eee7a7713ab831a11e9e7406"><div class="ttname"><a href="classPacket.html#ae035c719eee7a7713ab831a11e9e7406">Packet::headerDelay</a></div><div class="ttdeci">uint32_t headerDelay</div><div class="ttdoc">The extra delay from seeing the packet until the header is transmitted. </div><div class="ttdef"><b>Definition:</b> <a href="packet_8hh_source.html#l00366">packet.hh:366</a></div></div>
<div class="ttc" id="base_2types_8hh_html_a5c8ed81b7d238c9083e1037ba6d61643"><div class="ttname"><a href="base_2types_8hh.html#a5c8ed81b7d238c9083e1037ba6d61643">Tick</a></div><div class="ttdeci">uint64_t Tick</div><div class="ttdoc">Tick count type. </div><div class="ttdef"><b>Definition:</b> <a href="base_2types_8hh_source.html#l00063">types.hh:63</a></div></div>
<div class="ttc" id="classBaseXBar_html_ab7eff749b4772ee3438917d04d94eaed"><div class="ttname"><a href="classBaseXBar.html#ab7eff749b4772ee3438917d04d94eaed">BaseXBar::transDist</a></div><div class="ttdeci">Stats::Vector transDist</div><div class="ttdoc">Stats for transaction distribution and data passing through the crossbar. </div><div class="ttdef"><b>Definition:</b> <a href="xbar_8hh_source.html#l00401">xbar.hh:401</a></div></div>
<div class="ttc" id="classPacket_html_ae116431868d1c7f6b0dd127bbb7faeab"><div class="ttname"><a href="classPacket.html#ae116431868d1c7f6b0dd127bbb7faeab">Packet::isResponse</a></div><div class="ttdeci">bool isResponse() const</div><div class="ttdef"><b>Definition:</b> <a href="packet_8hh_source.html#l00532">packet.hh:532</a></div></div>
<div class="ttc" id="classCoherentXBar_html_a31f46d511a2a1753a1fd0e153cf71d39"><div class="ttname"><a href="classCoherentXBar.html#a31f46d511a2a1753a1fd0e153cf71d39">CoherentXBar::isDestination</a></div><div class="ttdeci">bool isDestination(const PacketPtr pkt) const</div><div class="ttdoc">Determine if the packet&amp;#39;s destination is the memory below. </div><div class="ttdef"><b>Definition:</b> <a href="coherent__xbar_8hh_source.html#l00415">coherent_xbar.hh:415</a></div></div>
<div class="ttc" id="classCoherentXBar_html_a39752a3f16e31e5f64dccdd8e9db7731"><div class="ttname"><a href="classCoherentXBar.html#a39752a3f16e31e5f64dccdd8e9db7731">CoherentXBar::recvTimingSnoopReq</a></div><div class="ttdeci">void recvTimingSnoopReq(PacketPtr pkt, PortID master_port_id)</div><div class="ttdef"><b>Definition:</b> <a href="coherent__xbar_8cc_source.html#l00506">coherent_xbar.cc:506</a></div></div>
<div class="ttc" id="classCoherentXBar_html_a22f47e8bf9304bae4534bc58192f9132"><div class="ttname"><a href="classCoherentXBar.html#a22f47e8bf9304bae4534bc58192f9132">CoherentXBar::maxRoutingTableSizeCheck</a></div><div class="ttdeci">const unsigned int maxRoutingTableSizeCheck</div><div class="ttdoc">Maximum routing table size sanity check. </div><div class="ttdef"><b>Definition:</b> <a href="coherent__xbar_8hh_source.html#l00288">coherent_xbar.hh:288</a></div></div>
<div class="ttc" id="classCoherentXBar_html_a4c9ed4ae8ea2994335c52927ee205c89"><div class="ttname"><a href="classCoherentXBar.html#a4c9ed4ae8ea2994335c52927ee205c89">CoherentXBar::CoherentXBar</a></div><div class="ttdeci">CoherentXBar(const CoherentXBarParams *p)</div><div class="ttdef"><b>Definition:</b> <a href="coherent__xbar_8cc_source.html#l00059">coherent_xbar.cc:59</a></div></div>
<div class="ttc" id="classCoherentXBar_html_a9f9454818f672a40a28538c8b8496633"><div class="ttname"><a href="classCoherentXBar.html#a9f9454818f672a40a28538c8b8496633">CoherentXBar::snoopFilter</a></div><div class="ttdeci">SnoopFilter * snoopFilter</div><div class="ttdoc">A snoop filter that tracks cache line residency and can restrict the broadcast needed for probes...</div><div class="ttdef"><b>Definition:</b> <a href="coherent__xbar_8hh_source.html#l00279">coherent_xbar.hh:279</a></div></div>
<div class="ttc" id="classPacket_html_a5d8b9bb469e6879c03c73effe3640634"><div class="ttname"><a href="classPacket.html#a5d8b9bb469e6879c03c73effe3640634">Packet::getAddr</a></div><div class="ttdeci">Addr getAddr() const</div><div class="ttdef"><b>Definition:</b> <a href="packet_8hh_source.html#l00726">packet.hh:726</a></div></div>
<div class="ttc" id="classPacket_html_aa71d1ff754f712c337e8908a1595f8a0"><div class="ttname"><a href="classPacket.html#aa71d1ff754f712c337e8908a1595f8a0">Packet::getAddrRange</a></div><div class="ttdeci">AddrRange getAddrRange() const</div><div class="ttdoc">Get address range to which this packet belongs. </div><div class="ttdef"><b>Definition:</b> <a href="packet_8cc_source.html#l00228">packet.cc:228</a></div></div>
<div class="ttc" id="classPacket_html_a389afe9616729132378ab8228a74441d"><div class="ttname"><a href="classPacket.html#a389afe9616729132378ab8228a74441d">Packet::hasData</a></div><div class="ttdeci">bool hasData() const</div><div class="ttdef"><b>Definition:</b> <a href="packet_8hh_source.html#l00548">packet.hh:548</a></div></div>
<div class="ttc" id="classBaseXBar_html_a91a7cf37c038ad1e1f741ae43b076566"><div class="ttname"><a href="classBaseXBar.html#a91a7cf37c038ad1e1f741ae43b076566">BaseXBar::calcPacketTiming</a></div><div class="ttdeci">void calcPacketTiming(PacketPtr pkt, Tick header_delay)</div><div class="ttdoc">Calculate the timing parameters for the packet. </div><div class="ttdef"><b>Definition:</b> <a href="xbar_8cc_source.html#l00103">xbar.cc:103</a></div></div>
<div class="ttc" id="classStats_1_1Distribution_html_a80326f47cdebeca2c5c86427d04c7e19"><div class="ttname"><a href="classStats_1_1Distribution.html#a80326f47cdebeca2c5c86427d04c7e19">Stats::Distribution::init</a></div><div class="ttdeci">Distribution &amp; init(Counter min, Counter max, Counter bkt)</div><div class="ttdoc">Set the parameters of this distribution. </div><div class="ttdef"><b>Definition:</b> <a href="statistics_8hh_source.html#l02611">statistics.hh:2611</a></div></div>
<div class="ttc" id="classCoherentXBar_html_aae35f923360da4e14d780f55ae5dd4aa"><div class="ttname"><a href="classCoherentXBar.html#aae35f923360da4e14d780f55ae5dd4aa">CoherentXBar::recvTimingResp</a></div><div class="ttdeci">bool recvTimingResp(PacketPtr pkt, PortID master_port_id)</div><div class="ttdef"><b>Definition:</b> <a href="coherent__xbar_8cc_source.html#l00444">coherent_xbar.cc:444</a></div></div>
<div class="ttc" id="classCoherentXBar_html_afc0e823057dd03d2cde717ad1f0f56b2"><div class="ttname"><a href="classCoherentXBar.html#afc0e823057dd03d2cde717ad1f0f56b2">CoherentXBar::forwardTiming</a></div><div class="ttdeci">void forwardTiming(PacketPtr pkt, PortID exclude_slave_port_id)</div><div class="ttdoc">Forward a timing packet to our snoopers, potentially excluding one of the connected coherent masters ...</div><div class="ttdef"><b>Definition:</b> <a href="coherent__xbar_8hh_source.html#l00317">coherent_xbar.hh:317</a></div></div>
<div class="ttc" id="base_2types_8hh_html_af1bb03d6a4ee096394a6749f0a169232"><div class="ttname"><a href="base_2types_8hh.html#af1bb03d6a4ee096394a6749f0a169232">Addr</a></div><div class="ttdeci">uint64_t Addr</div><div class="ttdoc">Address type This will probably be moved somewhere else in the near future. </div><div class="ttdef"><b>Definition:</b> <a href="base_2types_8hh_source.html#l00142">types.hh:142</a></div></div>
<div class="ttc" id="classPacket_html_a672f63108880c72376276d9ed01b3fc3"><div class="ttname"><a href="classPacket.html#a672f63108880c72376276d9ed01b3fc3">Packet::payloadDelay</a></div><div class="ttdeci">uint32_t payloadDelay</div><div class="ttdoc">The extra pipelining delay from seeing the packet until the end of payload is transmitted by the comp...</div><div class="ttdef"><b>Definition:</b> <a href="packet_8hh_source.html#l00384">packet.hh:384</a></div></div>
<div class="ttc" id="classSimObject_html_ac6bf42a0c7d51f21477fc064f75178c1"><div class="ttname"><a href="classSimObject.html#ac6bf42a0c7d51f21477fc064f75178c1">SimObject::name</a></div><div class="ttdeci">virtual const std::string name() const</div><div class="ttdef"><b>Definition:</b> <a href="sim__object_8hh_source.html#l00120">sim_object.hh:120</a></div></div>
<div class="ttc" id="classCoherentXBar_html"><div class="ttname"><a href="classCoherentXBar.html">CoherentXBar</a></div><div class="ttdoc">A coherent crossbar connects a number of (potentially) snooping masters and slaves, and routes the request and response packets based on the address, and also forwards all requests to the snoopers and deals with the snoop responses. </div><div class="ttdef"><b>Definition:</b> <a href="coherent__xbar_8hh_source.html#l00072">coherent_xbar.hh:72</a></div></div>
<div class="ttc" id="classPacket_html"><div class="ttname"><a href="classPacket.html">Packet</a></div><div class="ttdoc">A Packet is used to encapsulate a transfer between two objects in the memory system (e...</div><div class="ttdef"><b>Definition:</b> <a href="packet_8hh_source.html#l00255">packet.hh:255</a></div></div>
<div class="ttc" id="classBaseXBar_html_ad10345cd3f63594c59921597e0614d53"><div class="ttname"><a href="classBaseXBar.html#ad10345cd3f63594c59921597e0614d53">BaseXBar::frontendLatency</a></div><div class="ttdeci">const Cycles frontendLatency</div><div class="ttdoc">Cycles of front-end pipeline including the delay to accept the request and to decode the address...</div><div class="ttdef"><b>Definition:</b> <a href="xbar_8hh_source.html#l00312">xbar.hh:312</a></div></div>
<div class="ttc" id="classClocked_html_a082ec89d11f90b11b91ba7876040e41e"><div class="ttname"><a href="classClocked.html#a082ec89d11f90b11b91ba7876040e41e">Clocked::clockEdge</a></div><div class="ttdeci">Tick clockEdge(Cycles cycles=Cycles(0)) const</div><div class="ttdoc">Determine the tick when a cycle begins, by default the current one, but the argument also enables the...</div><div class="ttdef"><b>Definition:</b> <a href="clocked__object_8hh_source.html#l00180">clocked_object.hh:180</a></div></div>
<div class="ttc" id="classSnoopFilter_html_a918b564146c158716460f12726f2a08c"><div class="ttname"><a href="classSnoopFilter.html#a918b564146c158716460f12726f2a08c">SnoopFilter::updateResponse</a></div><div class="ttdeci">void updateResponse(const Packet *cpkt, const SlavePort &amp;slave_port)</div><div class="ttdoc">Update the snoop filter with a response from below (outer / other cache, or memory) and update the tr...</div><div class="ttdef"><b>Definition:</b> <a href="snoop__filter_8cc_source.html#l00338">snoop_filter.cc:338</a></div></div>
<div class="ttc" id="classPacket_html_a828c8eada6caef43d3b13ca739ebb961"><div class="ttname"><a href="classPacket.html#a828c8eada6caef43d3b13ca739ebb961">Packet::responderHadWritable</a></div><div class="ttdeci">bool responderHadWritable() const</div><div class="ttdef"><b>Definition:</b> <a href="packet_8hh_source.html#l00651">packet.hh:651</a></div></div>
<div class="ttc" id="namespaceX86ISA_html_a313686d10ce407058a35bddec45c211f"><div class="ttname"><a href="namespaceX86ISA.html#a313686d10ce407058a35bddec45c211f">X86ISA::system</a></div><div class="ttdeci">Bitfield&lt; 15 &gt; system</div><div class="ttdef"><b>Definition:</b> <a href="arch_2x86_2regs_2misc_8hh_source.html#l00999">misc.hh:999</a></div></div>
<div class="ttc" id="coherent__xbar_8hh_html"><div class="ttname"><a href="coherent__xbar_8hh.html">coherent_xbar.hh</a></div><div class="ttdoc">Declaration of a coherent crossbar. </div></div>
<div class="ttc" id="classCoherentXBar_html_a8084244fa4dfb611dec054a4b437e1f9"><div class="ttname"><a href="classCoherentXBar.html#a8084244fa4dfb611dec054a4b437e1f9">CoherentXBar::recvAtomicSnoop</a></div><div class="ttdeci">Tick recvAtomicSnoop(PacketPtr pkt, PortID master_port_id)</div><div class="ttdef"><b>Definition:</b> <a href="coherent__xbar_8cc_source.html#l00880">coherent_xbar.cc:880</a></div></div>
<div class="ttc" id="classPacket_html_a14a73789b61dfcffbba858ea6210ef4c"><div class="ttname"><a href="classPacket.html#a14a73789b61dfcffbba858ea6210ef4c">Packet::cmdToIndex</a></div><div class="ttdeci">int cmdToIndex() const</div><div class="ttdoc">Return the index of this command. </div><div class="ttdef"><b>Definition:</b> <a href="packet_8hh_source.html#l00526">packet.hh:526</a></div></div>
<div class="ttc" id="classPacket_html_a0db65d99eef3f53f20af61190883d741"><div class="ttname"><a href="classPacket.html#a0db65d99eef3f53f20af61190883d741">Packet::satisfied</a></div><div class="ttdeci">bool satisfied() const</div><div class="ttdef"><b>Definition:</b> <a href="packet_8hh_source.html#l00687">packet.hh:687</a></div></div>
<div class="ttc" id="classBaseXBar_html_a7121edb077f36aece2830ffae4dc2f2c"><div class="ttname"><a href="classBaseXBar.html#a7121edb077f36aece2830ffae4dc2f2c">BaseXBar::masterPorts</a></div><div class="ttdeci">std::vector&lt; MasterPort * &gt; masterPorts</div><div class="ttdef"><b>Definition:</b> <a href="xbar_8hh_source.html#l00379">xbar.hh:379</a></div></div>
<div class="ttc" id="classPacket_html_a51e1ba3f32ebb3c8be10cf9b58ca54e0"><div class="ttname"><a href="classPacket.html#a51e1ba3f32ebb3c8be10cf9b58ca54e0">Packet::makeResponse</a></div><div class="ttdeci">void makeResponse()</div><div class="ttdoc">Take a request packet and modify it in place to be suitable for returning as a response to that reque...</div><div class="ttdef"><b>Definition:</b> <a href="packet_8hh_source.html#l00937">packet.hh:937</a></div></div>
<div class="ttc" id="classCoherentXBar_html_ae4bc8dc8c57cf49cbe8f4e9b4820abc6"><div class="ttname"><a href="classCoherentXBar.html#ae4bc8dc8c57cf49cbe8f4e9b4820abc6">CoherentXBar::snoopRespPorts</a></div><div class="ttdeci">std::vector&lt; SnoopRespPort * &gt; snoopRespPorts</div><div class="ttdef"><b>Definition:</b> <a href="coherent__xbar_8hh_source.html#l00253">coherent_xbar.hh:253</a></div></div>
<div class="ttc" id="classCoherentXBar_html_ae8842697fb1aa8204076bb4a80334b8c"><div class="ttname"><a href="classCoherentXBar.html#ae8842697fb1aa8204076bb4a80334b8c">CoherentXBar::snoops</a></div><div class="ttdeci">Stats::Scalar snoops</div><div class="ttdef"><b>Definition:</b> <a href="coherent__xbar_8hh_source.html#l00421">coherent_xbar.hh:421</a></div></div>
<div class="ttc" id="classBaseXBar_html_a636f80defcaea192d77f020ff0d83f9a"><div class="ttname"><a href="classBaseXBar.html#a636f80defcaea192d77f020ff0d83f9a">BaseXBar::slavePorts</a></div><div class="ttdeci">std::vector&lt; QueuedSlavePort * &gt; slavePorts</div><div class="ttdoc">The master and slave ports of the crossbar. </div><div class="ttdef"><b>Definition:</b> <a href="xbar_8hh_source.html#l00378">xbar.hh:378</a></div></div>
<div class="ttc" id="classPacket_html_a7a19b40cc01e43c41bc99fb7fadb89ea"><div class="ttname"><a href="classPacket.html#a7a19b40cc01e43c41bc99fb7fadb89ea">Packet::print</a></div><div class="ttdeci">void print(std::ostream &amp;o, int verbosity=0, const std::string &amp;prefix=&quot;&quot;) const</div><div class="ttdef"><b>Definition:</b> <a href="packet_8cc_source.html#l00376">packet.cc:376</a></div></div>
<div class="ttc" id="classPacket_html_ade61bff6cd470a7ce6376f3c85bdd3ae"><div class="ttname"><a href="classPacket.html#ade61bff6cd470a7ce6376f3c85bdd3ae">Packet::cmd</a></div><div class="ttdeci">MemCmd cmd</div><div class="ttdoc">The command field of the packet. </div><div class="ttdef"><b>Definition:</b> <a href="packet_8hh_source.html#l00322">packet.hh:322</a></div></div>
<div class="ttc" id="classSystem_html_abc658a627235f9f0fee0a19fd34e43ab"><div class="ttname"><a href="classSystem.html#abc658a627235f9f0fee0a19fd34e43ab">System::bypassCaches</a></div><div class="ttdeci">bool bypassCaches() const</div><div class="ttdoc">Should caches be bypassed? </div><div class="ttdef"><b>Definition:</b> <a href="sim_2system_8hh_source.html#l00160">system.hh:160</a></div></div>
<div class="ttc" id="classPacket_html_aee3d51b535ec42973453f5584dc16cb6"><div class="ttname"><a href="classPacket.html#aee3d51b535ec42973453f5584dc16cb6">Packet::isEviction</a></div><div class="ttdeci">bool isEviction() const</div><div class="ttdef"><b>Definition:</b> <a href="packet_8hh_source.html#l00544">packet.hh:544</a></div></div>
<div class="ttc" id="sim_2system_8hh_html"><div class="ttname"><a href="sim_2system_8hh.html">system.hh</a></div></div>
<div class="ttc" id="classPort_html_a18a1938a97583fef5c9cb8433df30ceb"><div class="ttname"><a href="classPort.html#a18a1938a97583fef5c9cb8433df30ceb">Port::name</a></div><div class="ttdeci">const std::string name() const</div><div class="ttdoc">Return port name (for DPRINTF). </div><div class="ttdef"><b>Definition:</b> <a href="sim_2port_8hh_source.html#l00106">port.hh:106</a></div></div>
<div class="ttc" id="classBaseXBar_html_a727799d20d95a711af40fba377f26788"><div class="ttname"><a href="classBaseXBar.html#a727799d20d95a711af40fba377f26788">BaseXBar::findPort</a></div><div class="ttdeci">PortID findPort(AddrRange addr_range)</div><div class="ttdoc">Find which port connected to this crossbar (if any) should be given a packet with this address range...</div><div class="ttdef"><b>Definition:</b> <a href="xbar_8cc_source.html#l00329">xbar.cc:329</a></div></div>
<div class="ttc" id="classCoherentXBar_html_a29d865089dc62927f3635540540ae499"><div class="ttname"><a href="classCoherentXBar.html#a29d865089dc62927f3635540540ae499">CoherentXBar::forwardFunctional</a></div><div class="ttdeci">void forwardFunctional(PacketPtr pkt, PortID exclude_slave_port_id)</div><div class="ttdoc">Forward a functional packet to our snoopers, potentially excluding one of the connected coherent mast...</div><div class="ttdef"><b>Definition:</b> <a href="coherent__xbar_8cc_source.html#l01048">coherent_xbar.cc:1048</a></div></div>
<div class="ttc" id="classPacket_html_a60a4bf642d67ecbba475a400c0842066"><div class="ttname"><a href="classPacket.html#a60a4bf642d67ecbba475a400c0842066">Packet::isPrint</a></div><div class="ttdeci">bool isPrint() const</div><div class="ttdef"><b>Definition:</b> <a href="packet_8hh_source.html#l00556">packet.hh:556</a></div></div>
<div class="ttc" id="classCoherentXBar_html_a38dc9251582760735568ea887761aa3b"><div class="ttname"><a href="classCoherentXBar.html#a38dc9251582760735568ea887761aa3b">CoherentXBar::forwardAtomic</a></div><div class="ttdeci">std::pair&lt; MemCmd, Tick &gt; forwardAtomic(PacketPtr pkt, PortID exclude_slave_port_id)</div><div class="ttdoc">Forward an atomic packet to our snoopers, potentially excluding one of the connected coherent masters...</div><div class="ttdef"><b>Definition:</b> <a href="coherent__xbar_8hh_source.html#l00349">coherent_xbar.hh:349</a></div></div>
<div class="ttc" id="classPacket_html_a4ed3d512e1660940c23561a0605f2ab3"><div class="ttname"><a href="classPacket.html#a4ed3d512e1660940c23561a0605f2ab3">Packet::setBlockCached</a></div><div class="ttdeci">void setBlockCached()</div><div class="ttdef"><b>Definition:</b> <a href="packet_8hh_source.html#l00691">packet.hh:691</a></div></div>
<div class="ttc" id="classPacket_html_aca85c7ecfa5461f6804ad4dbaec28b29"><div class="ttname"><a href="classPacket.html#aca85c7ecfa5461f6804ad4dbaec28b29">Packet::isSecure</a></div><div class="ttdeci">bool isSecure() const</div><div class="ttdef"><b>Definition:</b> <a href="packet_8hh_source.html#l00755">packet.hh:755</a></div></div>
<div class="ttc" id="classCoherentXBar_html_afd28320f6157ad949c85a56f680a9267"><div class="ttname"><a href="classCoherentXBar.html#afd28320f6157ad949c85a56f680a9267">CoherentXBar::regStats</a></div><div class="ttdeci">virtual void regStats()</div><div class="ttdoc">Callback to set stat parameters. </div><div class="ttdef"><b>Definition:</b> <a href="coherent__xbar_8cc_source.html#l01109">coherent_xbar.cc:1109</a></div></div>
<div class="ttc" id="classBaseXBar_1_1SnoopRespLayer_html"><div class="ttname"><a href="classBaseXBar_1_1SnoopRespLayer.html">BaseXBar::SnoopRespLayer</a></div><div class="ttdef"><b>Definition:</b> <a href="xbar_8hh_source.html#l00284">xbar.hh:284</a></div></div>
<div class="ttc" id="base_2types_8hh_html_acef4d7d41cb21fdc252e20c04cd7bb8e"><div class="ttname"><a href="base_2types_8hh.html#acef4d7d41cb21fdc252e20c04cd7bb8e">PortID</a></div><div class="ttdeci">int16_t PortID</div><div class="ttdoc">Port index/ID type, and a symbolic name for an invalid port id. </div><div class="ttdef"><b>Definition:</b> <a href="base_2types_8hh_source.html#l00237">types.hh:237</a></div></div>
<div class="ttc" id="classBaseXBar_html_af6aad4825ae3141ed0bac4c7b6a6fa23"><div class="ttname"><a href="classBaseXBar.html#af6aad4825ae3141ed0bac4c7b6a6fa23">BaseXBar::forwardLatency</a></div><div class="ttdeci">const Cycles forwardLatency</div><div class="ttdef"><b>Definition:</b> <a href="xbar_8hh_source.html#l00313">xbar.hh:313</a></div></div>
<div class="ttc" id="logging_8hh_html_a8224a361dddd2ad59b411982e5ea746f"><div class="ttname"><a href="logging_8hh.html#a8224a361dddd2ad59b411982e5ea746f">warn</a></div><div class="ttdeci">#define warn(...)</div><div class="ttdef"><b>Definition:</b> <a href="logging_8hh_source.html#l00212">logging.hh:212</a></div></div>
<div class="ttc" id="classPacket_html_a72bab6f4a0b9552b6555e57d0cf86b99"><div class="ttname"><a href="classPacket.html#a72bab6f4a0b9552b6555e57d0cf86b99">Packet::setExpressSnoop</a></div><div class="ttdeci">void setExpressSnoop()</div><div class="ttdoc">The express snoop flag is used for two purposes. </div><div class="ttdef"><b>Definition:</b> <a href="packet_8hh_source.html#l00633">packet.hh:633</a></div></div>
<div class="ttc" id="classCoherentXBar_html_a726c05f4a169fa7f45d02221ba290731"><div class="ttname"><a href="classCoherentXBar.html#a726c05f4a169fa7f45d02221ba290731">CoherentXBar::forwardPacket</a></div><div class="ttdeci">bool forwardPacket(const PacketPtr pkt)</div><div class="ttdoc">Determine if the crossbar should forward the packet, as opposed to responding to it. </div><div class="ttdef"><b>Definition:</b> <a href="coherent__xbar_8cc_source.html#l01094">coherent_xbar.cc:1094</a></div></div>
<div class="ttc" id="classCoherentXBar_html_a11067b3bac038801be5f9bb9abc679bf"><div class="ttname"><a href="classCoherentXBar.html#a11067b3bac038801be5f9bb9abc679bf">CoherentXBar::pointOfCoherency</a></div><div class="ttdeci">const bool pointOfCoherency</div><div class="ttdoc">Is this crossbar the point of coherency? </div><div class="ttdef"><b>Definition:</b> <a href="coherent__xbar_8hh_source.html#l00291">coherent_xbar.hh:291</a></div></div>
<div class="ttc" id="classSnoopFilter_html_a783d60950d399d382b01d151b139f6ce"><div class="ttname"><a href="classSnoopFilter.html#a783d60950d399d382b01d151b139f6ce">SnoopFilter::updateSnoopResponse</a></div><div class="ttdeci">void updateSnoopResponse(const Packet *cpkt, const SlavePort &amp;rsp_port, const SlavePort &amp;req_port)</div><div class="ttdoc">Let the snoop filter see any snoop responses that turn into request responses and indicate cache to c...</div><div class="ttdef"><b>Definition:</b> <a href="snoop__filter_8cc_source.html#l00244">snoop_filter.cc:244</a></div></div>
<div class="ttc" id="arch_2x86_2process_8cc_html_a4a522b8848c4afad8c6404708a44a05f"><div class="ttname"><a href="arch_2x86_2process_8cc.html#a4a522b8848c4afad8c6404708a44a05f">M5_VAR_USED</a></div><div class="ttdeci">static const int NumArgumentRegs M5_VAR_USED</div><div class="ttdef"><b>Definition:</b> <a href="arch_2x86_2process_8cc_source.html#l00084">process.cc:84</a></div></div>
<div class="ttc" id="classCoherentXBar_html_ad1cb401cd12fbfd94a3a118fe72cf0cd"><div class="ttname"><a href="classCoherentXBar.html#ad1cb401cd12fbfd94a3a118fe72cf0cd">CoherentXBar::recvTimingSnoopResp</a></div><div class="ttdeci">bool recvTimingSnoopResp(PacketPtr pkt, PortID slave_port_id)</div><div class="ttdef"><b>Definition:</b> <a href="coherent__xbar_8cc_source.html#l00566">coherent_xbar.cc:566</a></div></div>
<div class="ttc" id="namespaceMipsISA_html_ae12ae9e12fab22594609e2fefce7f7c2"><div class="ttname"><a href="namespaceMipsISA.html#ae12ae9e12fab22594609e2fefce7f7c2">MipsISA::p</a></div><div class="ttdeci">Bitfield&lt; 0 &gt; p</div><div class="ttdef"><b>Definition:</b> <a href="mips_2pra__constants_8hh_source.html#l00325">pra_constants.hh:325</a></div></div>
<div class="ttc" id="logging_8hh_html_af5c59b879d6a32dc657018ab3d30198f"><div class="ttname"><a href="logging_8hh.html#af5c59b879d6a32dc657018ab3d30198f">panic_if</a></div><div class="ttdeci">#define panic_if(cond,...)</div><div class="ttdoc">Conditional panic macro that checks the supplied condition and only panics if the condition is true a...</div><div class="ttdef"><b>Definition:</b> <a href="logging_8hh_source.html#l00185">logging.hh:185</a></div></div>
<div class="ttc" id="classMemCmd_html_ae5c39c2de0ad998b5176bc519b358102aefa7b894b47e6ffe03b70578c154b754"><div class="ttname"><a href="classMemCmd.html#ae5c39c2de0ad998b5176bc519b358102aefa7b894b47e6ffe03b70578c154b754">MemCmd::InvalidCmd</a></div><div class="ttdef"><b>Definition:</b> <a href="packet_8hh_source.html#l00086">packet.hh:86</a></div></div>
<div class="ttc" id="classBaseXBar_1_1ReqLayer_html"><div class="ttname"><a href="classBaseXBar_1_1ReqLayer.html">BaseXBar::ReqLayer</a></div><div class="ttdef"><b>Definition:</b> <a href="xbar_8hh_source.html#l00239">xbar.hh:239</a></div></div>
<div class="ttc" id="classMemCmd_html_ae5c39c2de0ad998b5176bc519b358102ab4e404a2679503dfab0a93913fe7960b"><div class="ttname"><a href="classMemCmd.html#ae5c39c2de0ad998b5176bc519b358102ab4e404a2679503dfab0a93913fe7960b">MemCmd::WriteClean</a></div><div class="ttdef"><b>Definition:</b> <a href="packet_8hh_source.html#l00094">packet.hh:94</a></div></div>
<div class="ttc" id="classBaseXBar_html_a247b474c367d5341b13814177e21ba8f"><div class="ttname"><a href="classBaseXBar.html#a247b474c367d5341b13814177e21ba8f">BaseXBar::pktSize</a></div><div class="ttdeci">Stats::Vector2d pktSize</div><div class="ttdef"><b>Definition:</b> <a href="xbar_8hh_source.html#l00403">xbar.hh:403</a></div></div>
<div class="ttc" id="namespaceMipsISA_html_aa834b70ca764da65920017e744b52dac"><div class="ttname"><a href="namespaceMipsISA.html#aa834b70ca764da65920017e744b52dac">MipsISA::l</a></div><div class="ttdeci">Bitfield&lt; 5 &gt; l</div><div class="ttdef"><b>Definition:</b> <a href="mips_2pra__constants_8hh_source.html#l00322">pra_constants.hh:322</a></div></div>
<div class="ttc" id="classCoherentXBar_html_aa9774d2b647b71de873961873011f460"><div class="ttname"><a href="classCoherentXBar.html#aa9774d2b647b71de873961873011f460">CoherentXBar::outstandingCMO</a></div><div class="ttdeci">std::unordered_map&lt; PacketId, PacketPtr &gt; outstandingCMO</div><div class="ttdoc">Store the outstanding cache maintenance that we are expecting snoop responses from so we can determin...</div><div class="ttdef"><b>Definition:</b> <a href="coherent__xbar_8hh_source.html#l00269">coherent_xbar.hh:269</a></div></div>
<div class="ttc" id="classStats_1_1DistBase_html_af90c2e330c98bf517d3ad40265647e74"><div class="ttname"><a href="classStats_1_1DistBase.html#af90c2e330c98bf517d3ad40265647e74">Stats::DistBase::sample</a></div><div class="ttdeci">void sample(const U &amp;v, int n=1)</div><div class="ttdoc">Add a value to the distribtion n times. </div><div class="ttdef"><b>Definition:</b> <a href="statistics_8hh_source.html#l01901">statistics.hh:1901</a></div></div>
<div class="ttc" id="classSnoopFilter_html_a9bdd8986f9d76c9e86be279d1353c0c8"><div class="ttname"><a href="classSnoopFilter.html#a9bdd8986f9d76c9e86be279d1353c0c8">SnoopFilter::lookupRequest</a></div><div class="ttdeci">std::pair&lt; SnoopList, Cycles &gt; lookupRequest(const Packet *cpkt, const SlavePort &amp;slave_port)</div><div class="ttdoc">Lookup a request (from a slave port) in the snoop filter and return a list of other slave ports that ...</div><div class="ttdef"><b>Definition:</b> <a href="snoop__filter_8cc_source.html#l00066">snoop_filter.cc:66</a></div></div>
<div class="ttc" id="classCoherentXBar_1_1CoherentXBarMasterPort_html"><div class="ttname"><a href="classCoherentXBar_1_1CoherentXBarMasterPort.html">CoherentXBar::CoherentXBarMasterPort</a></div><div class="ttdoc">Declaration of the coherent crossbar master port type, one will be instantiated for each of the slave...</div><div class="ttdef"><b>Definition:</b> <a href="coherent__xbar_8hh_source.html#l00154">coherent_xbar.hh:154</a></div></div>
<div class="ttc" id="classCoherentXBar_html_a6ad3a49a76453fdd1419af454bc28d70"><div class="ttname"><a href="classCoherentXBar.html#a6ad3a49a76453fdd1419af454bc28d70">CoherentXBar::recvAtomicBackdoor</a></div><div class="ttdeci">Tick recvAtomicBackdoor(PacketPtr pkt, PortID slave_port_id, MemBackdoorPtr *backdoor=nullptr)</div><div class="ttdef"><b>Definition:</b> <a href="coherent__xbar_8cc_source.html#l00729">coherent_xbar.cc:729</a></div></div>
<div class="ttc" id="classCoherentXBar_html_a75ce7d1a83fe327be570029650e0c610"><div class="ttname"><a href="classCoherentXBar.html#a75ce7d1a83fe327be570029650e0c610">CoherentXBar::recvFunctional</a></div><div class="ttdeci">void recvFunctional(PacketPtr pkt, PortID slave_port_id)</div><div class="ttdoc">Function called by the port when the crossbar is recieving a Functional transaction. </div><div class="ttdef"><b>Definition:</b> <a href="coherent__xbar_8cc_source.html#l00992">coherent_xbar.cc:992</a></div></div>
<div class="ttc" id="classBaseXBar_html_a69fb0712713b5ffa4a6f9f57397fd2d7"><div class="ttname"><a href="classBaseXBar.html#a69fb0712713b5ffa4a6f9f57397fd2d7">BaseXBar::pktCount</a></div><div class="ttdeci">Stats::Vector2d pktCount</div><div class="ttdef"><b>Definition:</b> <a href="xbar_8hh_source.html#l00402">xbar.hh:402</a></div></div>
<div class="ttc" id="classCoherentXBar_html_ae26e86486b723037aa83b6f488e05c97"><div class="ttname"><a href="classCoherentXBar.html#ae26e86486b723037aa83b6f488e05c97">CoherentXBar::init</a></div><div class="ttdeci">virtual void init()</div><div class="ttdoc">init() is called after all C++ SimObjects have been created and all ports are connected. </div><div class="ttdef"><b>Definition:</b> <a href="coherent__xbar_8cc_source.html#l00123">coherent_xbar.cc:123</a></div></div>
<div class="ttc" id="classCoherentXBar_html_ade12b0118a2a220183b3392e0a2523f3"><div class="ttname"><a href="classCoherentXBar.html#ade12b0118a2a220183b3392e0a2523f3">CoherentXBar::snoopPorts</a></div><div class="ttdeci">std::vector&lt; QueuedSlavePort * &gt; snoopPorts</div><div class="ttdef"><b>Definition:</b> <a href="coherent__xbar_8hh_source.html#l00255">coherent_xbar.hh:255</a></div></div>
<div class="ttc" id="classPacket_html_a68b7449d2290af366ffd6dd8f59ebe45"><div class="ttname"><a href="classPacket.html#a68b7449d2290af366ffd6dd8f59ebe45">Packet::clearWriteThrough</a></div><div class="ttdeci">void clearWriteThrough()</div><div class="ttdef"><b>Definition:</b> <a href="packet_8hh_source.html#l00673">packet.hh:673</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<hr size="1"><address style="align: right;"><small>
Generated on Mon Nov 25 2019 12:52:09 for gem5 by <a href="http://www.doxygen.org/index.html"> doxygen</a> 1.8.13</small></address>
</body>
</html>
